import{B as ot}from"./BBoprNr9.js";import{k as rt,f as H,V as at}from"./CBsAYBMq.js";import{a as A}from"./NcfOxGOJ.js";import{c as x,b as j,l as lt,d as ht,m as V}from"./Ba_gg6Bw.js";import{W,i as K,z as E,a as v,u as S,X as O,f as p,m as w,r as ut,Y as ct,t as X,P as gt,b as dt,Z as z,_ as ft,S as _t,M as Rt}from"./1jRA9jIJ.js";import{c as mt,d as Ct,e as Mt,D as xt}from"./DCo6-o3V.js";import{S as B,d as pt,P as It,a as At}from"./BAiuiMj1.js";import{d as yt,o as Y,g as wt,l as Ft,q as jt}from"./Cc173s93.js";import{l as Tt}from"./BNCPP-Lc.js";const I={ANIMATING:0,INTERACTING:1},m={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function G(s,t,e){return function(n,i,r,a,l){if(!n)return;if(!i&&!t)return n;const o=t?0:r[0]*i,g=t?0:r[1]*i,h=l?l[0]:0,u=l?l[1]:0;let c=s[0]+o/2+h,d=s[2]-o/2+h,f=s[1]+g/2+u,_=s[3]-g/2+u;c>d&&(c=(d+c)/2,d=c),f>_&&(f=(_+f)/2,_=f);let R=x(n[0],c,d),C=x(n[1],f,_);if(a&&e&&i){const M=30*i;R+=-M*Math.log(1+Math.max(0,c-n[0])/M)+M*Math.log(1+Math.max(0,n[0]-d)/M),C+=-M*Math.log(1+Math.max(0,f-n[1])/M)+M*Math.log(1+Math.max(0,n[1]-_)/M)}return[R,C]}}function Nt(s){return s}function $(s,t,e,n){let i=0;const r=s[e-n],a=s[e-n+1];let l=0,o=0;for(;t<e;t+=n){const g=s[t]-r,h=s[t+1]-a;i+=o*g-l*h,l=g,o=h}return i/2}function Zt(s,t,e,n){let i=0;for(let r=0,a=e.length;r<a;++r){const l=e[r];i+=$(s,t,l,n),t=l}return i}function L(s,t,e,n,i,r,a){const l=s[t],o=s[t+1],g=s[e]-l,h=s[e+1]-o;let u;if(g===0&&h===0)u=t;else{const c=((i-l)*g+(r-o)*h)/(g*g+h*h);if(c>1)u=e;else if(c>0){for(let d=0;d<n;++d)a[d]=lt(s[t+d],s[e+d],c);a.length=n;return}else u=t}for(let c=0;c<n;++c)a[c]=s[u+c];a.length=n}function q(s,t,e,n,i){let r=s[t],a=s[t+1];for(t+=n;t<e;t+=n){const l=s[t],o=s[t+1],g=j(r,a,l,o);g>i&&(i=g),r=l,a=o}return i}function Et(s,t,e,n,i){for(let r=0,a=e.length;r<a;++r){const l=e[r];i=q(s,t,l,n,i),t=l}return i}function J(s,t,e,n,i,r,a,l,o,g,h){if(t==e)return g;let u,c;if(i===0){if(c=j(a,l,s[t],s[t+1]),c<g){for(u=0;u<n;++u)o[u]=s[t+u];return o.length=n,c}return g}h=h||[NaN,NaN];let d=t+n;for(;d<e;)if(L(s,d-n,d,n,a,l,h),c=j(a,l,h[0],h[1]),c<g){for(g=c,u=0;u<n;++u)o[u]=h[u];o.length=n,d+=n}else d+=n*Math.max((Math.sqrt(c)-Math.sqrt(g))/i|0,1);if(L(s,e-n,t,n,a,l,h),c=j(a,l,h[0],h[1]),c<g){for(g=c,u=0;u<n;++u)o[u]=h[u];o.length=n}return g}function zt(s,t,e,n,i,r,a,l,o,g,h){h=h||[NaN,NaN];for(let u=0,c=e.length;u<c;++u){const d=e[u];g=J(s,t,d,n,i,r,a,l,o,g,h),t=d}return g}function Q(s,t,e,n,i){i=i!==void 0?i:[];let r=0;for(let a=t;a<e;a+=n)i[r++]=s.slice(a,a+n);return i.length=r,i}function tt(s,t,e,n,i){i=i!==void 0?i:[];let r=0;for(let a=0,l=e.length;a<l;++a){const o=e[a];i[r++]=Q(s,t,o,n,i[r]),t=o}return i.length=r,i}function Kt(s,t,e,n,i){i=i!==void 0?i:[];let r=0;for(let a=0,l=e.length;a<l;++a){const o=e[a];i[r++]=o.length===1&&o[0]===t?[]:tt(s,t,o,n,i[r]),t=o[o.length-1]}return i.length=r,i}class y extends B{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new y(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,i){return i<W(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(q(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),J(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,i))}getArea(){return $(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Q(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=yt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new y(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=pt(this.flatCoordinates,0,t,this.stride),this.changed()}}class T extends B{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?rt(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new T(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,i){return i<W(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Et(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),zt(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,i))}containsXY(t,e){return Tt(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Zt(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Y(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,tt(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=E(this.getExtent());this.flatInteriorPoint_=wt(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new It(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new y(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,i=[];let r=0;for(let a=0,l=n.length;a<l;++a){const o=n[a],g=new y(e.slice(r,o),t);i.push(g),r=o}return i}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Ft(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Y(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=jt(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new T(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return mt(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=At(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function U(s){if(K(s))throw new Error("Cannot create polygon from empty extent");const t=s[0],e=s[1],n=s[2],i=s[3],r=[t,e,t,i,n,i,n,e,t,e];return new T(r,"XY",[r.length])}function P(s,t,e,n){const i=v(t)/e[0],r=S(t)/e[1];return n?Math.min(s,Math.max(i,r)):Math.min(s,Math.min(i,r))}function b(s,t,e){let n=Math.min(s,t);const i=50;return n*=Math.log(1+i*Math.max(0,s/t-1))/i+1,e&&(n=Math.max(n,e),n/=Math.log(1+i*Math.max(0,e/s-1))/i+1),x(n,e/2,t*2)}function vt(s,t,e,n){return t=t!==void 0?t:!0,function(i,r,a,l){if(i!==void 0){const o=s[0],g=s[s.length-1],h=e?P(o,e,a,n):o;if(l)return t?b(i,h,g):x(i,g,h);const u=Math.min(h,i),c=Math.floor(H(s,u,r));return s[c]>h&&c<s.length-1?s[c+1]:s[c]}}}function St(s,t,e,n,i,r){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(a,l,o,g){if(a!==void 0){const h=i?P(t,i,o,r):t;if(g)return n?b(a,h,e):x(a,e,h);const u=1e-9,c=Math.ceil(Math.log(t/h)/Math.log(s)-u),d=-l*(.5-u)+.5,f=Math.min(h,a),_=Math.floor(Math.log(t/f)/Math.log(s)+d),R=Math.max(c,_),C=t/Math.pow(s,R);return x(C,e,h)}}}function k(s,t,e,n,i){return e=e!==void 0?e:!0,function(r,a,l,o){if(r!==void 0){const g=n?P(s,n,l,i):s;return!e||!o?x(r,t,g):b(r,g,t)}}}function Ot(s){if(s!==void 0)return 0}function D(s){if(s!==void 0)return s}function Pt(s){const t=2*Math.PI/s;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function bt(s){const t=ht(5);return function(e,n){return n||e===void 0?e:Math.abs(e)<=t?0:e}}const N=0;class Vt extends ot{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=O(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&ft(),t.center&&(t.center=p(t.center,this.projection_)),t.extent&&(t.extent=w(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const l in m)delete e[l];this.setProperties(e,!0);const n=nt(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const i=et(t),r=n.constraint,a=it(t);this.constraints_={center:i,resolution:r,rotation:a},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const i=t||[0,0,0,0];e=e||[0,0,0,0];const r=this.getResolution(),a=r/2*(i[3]-e[3]+e[1]-i[1]),l=r/2*(i[0]-e[0]+e[2]-i[2]);this.setCenterInternal([n[0]+a,n[1]-l])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let n=0;n<e.length;++n){let i=arguments[n];i.center&&(i=Object.assign({},i),i.center=p(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=p(i.anchor,this.getProjection())),e[n]=i}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let i=0;for(;i<e&&!this.isDef();++i){const h=arguments[i];h.center&&this.setCenterInternal(h.center),h.zoom!==void 0?this.setZoom(h.zoom):h.resolution&&this.setResolution(h.resolution),h.rotation!==void 0&&this.setRotation(h.rotation)}if(i===e){n&&F(n,!0);return}let r=Date.now(),a=this.targetCenter_.slice(),l=this.targetResolution_,o=this.targetRotation_;const g=[];for(;i<e;++i){const h=arguments[i],u={start:r,complete:!1,anchor:h.anchor,duration:h.duration!==void 0?h.duration:1e3,easing:h.easing||Ct,callback:n};if(h.center&&(u.sourceCenter=a,u.targetCenter=h.center.slice(),a=u.targetCenter),h.zoom!==void 0?(u.sourceResolution=l,u.targetResolution=this.getResolutionForZoom(h.zoom),l=u.targetResolution):h.resolution&&(u.sourceResolution=l,u.targetResolution=h.resolution,l=u.targetResolution),h.rotation!==void 0){u.sourceRotation=o;const c=V(h.rotation-o+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=o+c,o=u.targetRotation}st(u)?u.complete=!0:r+=u.duration,g.push(u)}this.animations_.push(g),this.setHint(I.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[I.ANIMATING]>0}getInteracting(){return this.hints_[I.INTERACTING]>0}cancelAnimations(){this.setHint(I.ANIMATING,-this.hints_[I.ANIMATING]);let t;for(let e=0,n=this.animations_.length;e<n;++e){const i=this.animations_[e];if(i[0].callback&&F(i[0].callback,!1),!t)for(let r=0,a=i.length;r<a;++r){const l=i[r];if(!l.complete){t=l.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const i=this.animations_[n];let r=!0;for(let a=0,l=i.length;a<l;++a){const o=i[a];if(o.complete)continue;const g=t-o.start;let h=o.duration>0?g/o.duration:1;h>=1?(o.complete=!0,h=1):r=!1;const u=o.easing(h);if(o.sourceCenter){const c=o.sourceCenter[0],d=o.sourceCenter[1],f=o.targetCenter[0],_=o.targetCenter[1];this.nextCenter_=o.targetCenter;const R=c+u*(f-c),C=d+u*(_-d);this.targetCenter_=[R,C]}if(o.sourceResolution&&o.targetResolution){const c=u===1?o.targetResolution:o.sourceResolution+u*(o.targetResolution-o.sourceResolution);if(o.anchor){const d=this.getViewportSize_(this.getRotation()),f=this.constraints_.resolution(c,0,d,!0);this.targetCenter_=this.calculateCenterZoom(f,o.anchor)}this.nextResolution_=o.targetResolution,this.targetResolution_=c,this.applyTargetState_(!0)}if(o.sourceRotation!==void 0&&o.targetRotation!==void 0){const c=u===1?V(o.targetRotation+Math.PI,2*Math.PI)-Math.PI:o.sourceRotation+u*(o.targetRotation-o.sourceRotation);if(o.anchor){const d=this.constraints_.rotation(c,!0);this.targetCenter_=this.calculateCenterRotate(d,o.anchor)}this.nextRotation_=o.targetRotation,this.targetRotation_=c}if(this.applyTargetState_(!0),e=!0,!o.complete)break}if(r){this.animations_[n]=null,this.setHint(I.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const a=i[0].callback;a&&F(a,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const i=this.getCenterInternal();return i!==void 0&&(n=[i[0]-e[0],i[1]-e[1]],ut(n,t-this.getRotation()),ct(n,e)),n}calculateCenterZoom(t,e){let n;const i=this.getCenterInternal(),r=this.getResolution();if(i!==void 0&&r!==void 0){const a=e[0]-t*(e[0]-i[0])/r,l=e[1]-t*(e[1]-i[1])/r;n=[a,l]}return n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],i=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(i*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(i*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&X(t,this.getProjection())}getCenterInternal(){return this.get(m.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return gt(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();A(e,"The view center is not defined");const n=this.getResolution();A(n!==void 0,"The view resolution is not defined");const i=this.getRotation();return A(i!==void 0,"The view rotation is not defined"),dt(e,n,i,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(m.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(w(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=v(t)/e[0],i=S(t)/e[1];return Math.max(n,i)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(e/n)/Math.log(t);return function(r){return e/Math.pow(t,r*i)}}getRotation(){return this.get(m.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,r=Math.log(n/i)/e;return function(a){return Math.log(n/a)/e/r}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let i=this.getCenterInternal();const r=this.padding_;if(r){const a=this.getViewportSizeMinusPadding_();i=Z(i,this.getViewportSize_(),[a[0]/2+r[3],a[1]/2+r[0]],e,n)}return{center:i.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,n,i;if(this.resolutions_){const r=H(this.resolutions_,t,1);e=r,n=this.resolutions_[r],r==this.resolutions_.length-1?i=2:i=n/this.resolutions_[r+1]}else n=this.maxResolution_,i=this.zoomFactor_;return e+Math.log(n/t)/Math.log(i)}getResolutionForZoom(t){var e;if((e=this.resolutions_)!=null&&e.length){if(this.resolutions_.length===1)return this.resolutions_[0];const n=x(Math.floor(t),0,this.resolutions_.length-2),i=this.resolutions_[n]/this.resolutions_[n+1];return this.resolutions_[n]/Math.pow(i,x(t-n,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(A(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){A(!K(t),"Cannot fit empty extent provided as `geometry`");const i=w(t,this.getProjection());n=U(i)}else if(t.getType()==="Circle"){const i=w(t.getExtent(),this.getProjection());n=U(i),n.rotate(this.getRotation(),E(i))}else{const i=_t();i?n=t.clone().transform(i,this.getProjection()):n=t}this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),i=Math.sin(-e),r=t.getFlatCoordinates(),a=t.getStride();let l=1/0,o=1/0,g=-1/0,h=-1/0;for(let u=0,c=r.length;u<c;u+=a){const d=r[u]*n-r[u+1]*i,f=r[u]*i+r[u+1]*n;l=Math.min(l,d),o=Math.min(o,f),g=Math.max(g,d),h=Math.max(h,f)}return[l,o,g,h]}fitInternal(t,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());const i=e.padding!==void 0?e.padding:[0,0,0,0],r=e.nearest!==void 0?e.nearest:!1;let a;e.minResolution!==void 0?a=e.minResolution:e.maxZoom!==void 0?a=this.getResolutionForZoom(e.maxZoom):a=0;const l=this.rotatedExtentForGeometry(t);let o=this.getResolutionForExtentInternal(l,[n[0]-i[1]-i[3],n[1]-i[0]-i[2]]);o=isNaN(o)?a:Math.max(o,a),o=this.getConstrainedResolution(o,r?0:1);const g=this.getRotation(),h=Math.sin(g),u=Math.cos(g),c=E(l);c[0]+=(i[1]-i[3])/2*o,c[1]+=(i[0]-i[2])/2*o;const d=c[0]*u-c[1]*h,f=c[1]*u+c[0]*h,_=this.getConstrainedCenter([d,f],o),R=e.callback?e.callback:at;e.duration!==void 0?this.animateInternal({resolution:o,center:_,duration:e.duration,easing:e.easing},R):(this.targetResolution_=o,this.targetCenter_=_,this.applyTargetState_(!1,!0),F(R,!0))}centerOn(t,e,n){this.centerOnInternal(p(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(Z(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,i){let r;const a=this.padding_;if(a&&t){const l=this.getViewportSizeMinusPadding_(-n),o=Z(t,i,[l[0]/2+a[3],l[1]/2+a[0]],e,n);r=[t[0]-o[0],t[1]-o[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=X(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&p(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),i=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,i,n);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=p(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(i,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&p(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,i=this.constraints_.rotation(this.targetRotation_,n),r=this.getViewportSize_(i),a=this.constraints_.resolution(this.targetResolution_,0,r,n),l=this.constraints_.center(this.targetCenter_,a,r,n,this.calculateCenterShift(this.targetCenter_,a,i,r));this.get(m.ROTATION)!==i&&this.set(m.ROTATION,i),this.get(m.RESOLUTION)!==a&&(this.set(m.RESOLUTION,a),this.set("zoom",this.getZoom(),!0)),(!l||!this.get(m.CENTER)||!z(this.get(m.CENTER),l))&&this.set(m.CENTER,l),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=t!==void 0?t:200;const i=e||0,r=this.constraints_.rotation(this.targetRotation_),a=this.getViewportSize_(r),l=this.constraints_.resolution(this.targetResolution_,i,a),o=this.constraints_.center(this.targetCenter_,l,a,!1,this.calculateCenterShift(this.targetCenter_,l,r,a));if(t===0&&!this.cancelAnchor_){this.targetResolution_=l,this.targetRotation_=r,this.targetCenter_=o,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==l||this.getRotation()!==r||!this.getCenterInternal()||!z(this.getCenterInternal(),o))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:o,resolution:l,duration:t,easing:Mt,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(I.INTERACTING,1)}endInteraction(t,e,n){n=n&&p(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){this.getInteracting()&&(this.setHint(I.INTERACTING,-1),this.resolveConstraints(t,e,n))}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}}function F(s,t){setTimeout(function(){s(t)},0)}function et(s){if(s.extent!==void 0){const e=s.smoothExtentConstraint!==void 0?s.smoothExtentConstraint:!0;return G(s.extent,s.constrainOnlyCenter,e)}const t=O(s.projection,"EPSG:3857");if(s.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,G(e,!1,!1)}return Nt}function nt(s){let t,e,n,a=s.minZoom!==void 0?s.minZoom:N,l=s.maxZoom!==void 0?s.maxZoom:28;const o=s.zoomFactor!==void 0?s.zoomFactor:2,g=s.multiWorld!==void 0?s.multiWorld:!1,h=s.smoothResolutionConstraint!==void 0?s.smoothResolutionConstraint:!0,u=s.showFullExtent!==void 0?s.showFullExtent:!1,c=O(s.projection,"EPSG:3857"),d=c.getExtent();let f=s.constrainOnlyCenter,_=s.extent;if(!g&&!_&&c.isGlobal()&&(f=!1,_=d),s.resolutions!==void 0){const R=s.resolutions;e=R[a],n=R[l]!==void 0?R[l]:R[R.length-1],s.constrainResolution?t=vt(R,h,!f&&_,u):t=k(e,n,h,!f&&_,u)}else{const C=(d?Math.max(v(d),S(d)):360*Rt.degrees/c.getMetersPerUnit())/xt/Math.pow(2,N),M=C/Math.pow(2,28-N);e=s.maxResolution,e!==void 0?a=0:e=C/Math.pow(o,a),n=s.minResolution,n===void 0&&(s.maxZoom!==void 0?s.maxResolution!==void 0?n=e/Math.pow(o,l):n=C/Math.pow(o,l):n=M),l=a+Math.floor(Math.log(e/n)/Math.log(o)),n=e/Math.pow(o,l-a),s.constrainResolution?t=St(o,e,n,h,!f&&_,u):t=k(e,n,h,!f&&_,u)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:a,zoomFactor:o}}function it(s){if(s.enableRotation!==void 0?s.enableRotation:!0){const e=s.constrainRotation;return e===void 0||e===!0?bt():e===!1?D:typeof e=="number"?Pt(e):D}return Ot}function st(s){return!(s.sourceCenter&&s.targetCenter&&!z(s.sourceCenter,s.targetCenter)||s.sourceResolution!==s.targetResolution||s.sourceRotation!==s.targetRotation)}function Z(s,t,e,n,i){const r=Math.cos(-i);let a=Math.sin(-i),l=s[0]*r-s[1]*a,o=s[1]*r+s[0]*a;l+=(t[0]/2-e[0])*n,o+=(e[1]-t[1]/2)*n,a=-a;const g=l*r-o*a,h=o*r+l*a;return[g,h]}const Bt=Object.freeze(Object.defineProperty({__proto__:null,createCenterConstraint:et,createResolutionConstraint:nt,createRotationConstraint:it,default:Vt,isNoopAnimation:st},Symbol.toStringTag,{value:"Module"}));export{T as P,Vt as V,I as a,tt as b,Kt as c,Ot as d,Bt as e,Q as i};
