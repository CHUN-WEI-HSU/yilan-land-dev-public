function I(e,t,i=0,n=e.length-1,o=S){for(;n>i;){if(n-i>600){const c=n-i+1,r=t-i+1,a=Math.log(c),m=.5*Math.exp(2*a/3),f=.5*Math.sqrt(a*m*(c-m)/c)*(r-c/2<0?-1:1),Y=Math.max(i,Math.floor(t-r*m/c+f)),y=Math.min(n,Math.floor(t+(c-r)*m/c+f));I(e,t,Y,y,o)}const s=e[t];let l=i,h=n;for(d(e,i,t),o(e[n],s)>0&&d(e,i,n);l<h;){for(d(e,l,h),l++,h--;o(e[l],s)<0;)l++;for(;o(e[h],s)>0;)h--}o(e[i],s)===0?d(e,i,h):(h++,d(e,h,n)),h<=t&&(i=h+1),t<=h&&(n=h-1)}}function d(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}function S(e,t){return e<t?-1:e>t?1:0}let j=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let i=this.data;const n=[];if(!X(t,i))return n;const o=this.toBBox,s=[];for(;i;){for(let l=0;l<i.children.length;l++){const h=i.children[l],c=i.leaf?o(h):h;X(t,c)&&(i.leaf?n.push(h):g(t,c)?this._all(h,n):s.push(h))}i=s.pop()}return n}collides(t){let i=this.data;if(!X(t,i))return!1;const n=[];for(;i;){for(let o=0;o<i.children.length;o++){const s=i.children[o],l=i.leaf?this.toBBox(s):s;if(X(t,l)){if(i.leaf||g(t,l))return!0;n.push(s)}}i=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let i=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=i;else if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){const n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=x([]),this}remove(t,i){if(!t)return this;let n=this.data;const o=this.toBBox(t),s=[],l=[];let h,c,r;for(;n||s.length;){if(n||(n=s.pop(),c=s[s.length-1],h=l.pop(),r=!0),n.leaf){const a=E(t,n.children,i);if(a!==-1)return n.children.splice(a,1),s.push(n),this._condense(s),this}!r&&!n.leaf&&g(n,o)?(s.push(n),l.push(h),h=0,c=n,n=n.children[0]):c?(h++,n=c.children[h],r=!1):n=null}return this}toBBox(t){return t}compareMinX(t,i){return t.minX-i.minX}compareMinY(t,i){return t.minY-i.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,i){const n=[];for(;t;)t.leaf?i.push(...t.children):n.push(...t.children),t=n.pop();return i}_build(t,i,n,o){const s=n-i+1;let l=this._maxEntries,h;if(s<=l)return h=x(t.slice(i,n+1)),u(h,this.toBBox),h;o||(o=Math.ceil(Math.log(s)/Math.log(l)),l=Math.ceil(s/Math.pow(l,o-1))),h=x([]),h.leaf=!1,h.height=o;const c=Math.ceil(s/l),r=c*Math.ceil(Math.sqrt(l));w(t,i,n,r,this.compareMinX);for(let a=i;a<=n;a+=r){const m=Math.min(a+r-1,n);w(t,a,m,c,this.compareMinY);for(let f=a;f<=m;f+=c){const Y=Math.min(f+c-1,m);h.children.push(this._build(t,f,Y,o-1))}}return u(h,this.toBBox),h}_chooseSubtree(t,i,n,o){for(;o.push(i),!(i.leaf||o.length-1===n);){let s=1/0,l=1/0,h;for(let c=0;c<i.children.length;c++){const r=i.children[c],a=_(r),m=O(t,r)-a;m<l?(l=m,s=a<s?a:s,h=r):m===l&&a<s&&(s=a,h=r)}i=h||i.children[0]}return i}_insert(t,i,n){const o=n?t:this.toBBox(t),s=[],l=this._chooseSubtree(o,this.data,i,s);for(l.children.push(t),B(l,o);i>=0&&s[i].children.length>this._maxEntries;)this._split(s,i),i--;this._adjustParentBBoxes(o,s,i)}_split(t,i){const n=t[i],o=n.children.length,s=this._minEntries;this._chooseSplitAxis(n,s,o);const l=this._chooseSplitIndex(n,s,o),h=x(n.children.splice(l,n.children.length-l));h.height=n.height,h.leaf=n.leaf,u(n,this.toBBox),u(h,this.toBBox),i?t[i-1].children.push(h):this._splitRoot(n,h)}_splitRoot(t,i){this.data=x([t,i]),this.data.height=t.height+1,this.data.leaf=!1,u(this.data,this.toBBox)}_chooseSplitIndex(t,i,n){let o,s=1/0,l=1/0;for(let h=i;h<=n-i;h++){const c=p(t,0,h,this.toBBox),r=p(t,h,n,this.toBBox),a=N(c,r),m=_(c)+_(r);a<s?(s=a,o=h,l=m<l?m:l):a===s&&m<l&&(l=m,o=h)}return o||n-i}_chooseSplitAxis(t,i,n){const o=t.leaf?this.compareMinX:A,s=t.leaf?this.compareMinY:R,l=this._allDistMargin(t,i,n,o),h=this._allDistMargin(t,i,n,s);l<h&&t.children.sort(o)}_allDistMargin(t,i,n,o){t.children.sort(o);const s=this.toBBox,l=p(t,0,i,s),h=p(t,n-i,n,s);let c=M(l)+M(h);for(let r=i;r<n-i;r++){const a=t.children[r];B(l,t.leaf?s(a):a),c+=M(l)}for(let r=n-i-1;r>=i;r--){const a=t.children[r];B(h,t.leaf?s(a):a),c+=M(h)}return c}_adjustParentBBoxes(t,i,n){for(let o=n;o>=0;o--)B(i[o],t)}_condense(t){for(let i=t.length-1,n;i>=0;i--)t[i].children.length===0?i>0?(n=t[i-1].children,n.splice(n.indexOf(t[i]),1)):this.clear():u(t[i],this.toBBox)}};function E(e,t,i){if(!i)return t.indexOf(e);for(let n=0;n<t.length;n++)if(i(e,t[n]))return n;return-1}function u(e,t){p(e,0,e.children.length,t,e)}function p(e,t,i,n,o){o||(o=x(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let s=t;s<i;s++){const l=e.children[s];B(o,e.leaf?n(l):l)}return o}function B(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function A(e,t){return e.minX-t.minX}function R(e,t){return e.minY-t.minY}function _(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function M(e){return e.maxX-e.minX+(e.maxY-e.minY)}function O(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function N(e,t){const i=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),o=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,o-i)*Math.max(0,s-n)}function g(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function X(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function x(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function w(e,t,i,n,o){const s=[t,i];for(;s.length;){if(i=s.pop(),t=s.pop(),i-t<=n)continue;const l=t+Math.ceil((i-t)/n/2)*n;I(e,l,t,i,o),s.push(t,l,l,i)}}export{j as R};
