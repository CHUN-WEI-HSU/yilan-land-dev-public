import{n as D,p as C,q as G,M as Y,u as I,a as Z,k as p,v as k,x as S}from"./1jRA9jIJ.js";import{t as g,s as K}from"./ejpV0U7u.js";import{a as v,b as f,c as j,h as N,w as q,I as B,R as H}from"./CP3RsawU.js";import{a as T,i as W,h as $,g as E,d as V,B as J,E as Q}from"./DlQCJ7AR.js";import{D as y,i as tt,a as et}from"./DCo6-o3V.js";import{c as it,a as F,f as R,m as rt}from"./Ba_gg6Bw.js";import{T as x}from"./DENk7BAX.js";import{S as nt}from"./DSyt37PD.js";import"./JfErLOBA.js";import"./BNCPP-Lc.js";import"./sIom5plQ.js";const m=[0,0,0],d=5;class L{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,T(W(this.resolutions_,(r,n)=>n-r),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let r=0,n=this.resolutions_.length-1;r<n;++r)if(!e)e=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,T(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=D(i)),T(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,T(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:y,T(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((r,n)=>{const s=new v(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(i){const o=this.getTileRangeForExtentAndZ(i,n);s.minX=Math.max(o.minX,s.minX),s.maxX=Math.min(o.maxX,s.maxX),s.minY=Math.max(o.minY,s.minY),s.maxY=Math.min(o.maxY,s.maxY)}return s}):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const r=this.getTileRangeForExtentAndZ(t,e);for(let n=r.minX,s=r.maxX;n<=s;++n)for(let o=r.minY,a=r.maxY;o<=a;++o)i([e,n,o])}forEachTileCoordParentTileRange(t,e,i,r){let n,s,o,a=null,u=t[0]-1;for(this.zoomFactor_===2?(s=t[1],o=t[2]):a=this.getTileCoordExtent(t,r);u>=this.minZoom;){if(s!==void 0&&o!==void 0?(s=Math.floor(s/2),o=Math.floor(o/2),n=f(s,s,o,o,i)):n=this.getTileRangeForExtentAndZ(a,u,i),e(u,n))return!0;--u}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const n=t[1]*2,s=t[2]*2;return f(n,n+1,s,s+1,e)}const r=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const r=t[0],n=t[1],s=t[2];if(e===r)return f(n,s,n,s,i);if(this.zoomFactor_){const a=Math.pow(this.zoomFactor_,e-r),u=Math.floor(n*a),c=Math.floor(s*a);if(e<r)return f(u,u,c,c,i);const h=Math.floor(a*(n+1))-1,_=Math.floor(a*(s+1))-1;return f(u,h,c,_,i)}const o=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,m);const r=m[1],n=m[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,m);const s=m[1],o=m[2];return f(r,s,n,o,i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=g(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*i,e[1]-(t[2]+.5)*r[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=g(this.getTileSize(t[0]),this.tmpSize_),s=i[0]+t[1]*n[0]*r,o=i[1]-(t[2]+1)*n[1]*r,a=s+n[0]*r,u=o+n[1]*r;return C(s,o,a,u,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,r,n){const s=this.getZForResolution(i),o=i/this.getResolution(s),a=this.getOrigin(s),u=g(this.getTileSize(s),this.tmpSize_);let c=o*(t-a[0])/i/u[0],h=o*(a[1]-e)/i/u[1];return r?(c=F(c,d)-1,h=F(h,d)-1):(c=R(c,d),h=R(h,d)),j(s,c,h,n)}getTileCoordForXYAndZ_(t,e,i,r,n){const s=this.getOrigin(i),o=this.getResolution(i),a=g(this.getTileSize(i),this.tmpSize_);let u=(t-s[0])/o/a[0],c=(s[1]-e)/o/a[1];return r?(u=F(u,d)-1,c=F(c,d)-1):(u=R(u,d),c=R(c,d)),j(i,u,c,n)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=$(this.resolutions_,t,e||0);return it(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return tt(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let r=this.minZoom;r<e;++r)i[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=i}}function A(l){let t=l.getDefaultTileGrid();return t||(t=at(l),l.setDefaultTileGrid(t)),t}function st(l,t,e){const i=t[0],r=l.getTileCoordCenter(t),n=b(e);if(!p(n,r)){const s=Z(n),o=Math.ceil((n[0]-r[0])/s);return r[0]+=s*o,l.getTileCoordForCoordAndZ(r,i)}return t}function lt(l,t,e,i){i=i!==void 0?i:"top-left";const r=O(l,t,e);return new L({extent:l,origin:k(l,i),resolutions:r,tileSize:e})}function ot(l){const t=l||{},e=t.extent||G("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:O(e,t.maxZoom,t.tileSize,t.maxResolution)};return new L(i)}function O(l,t,e,i){t=t!==void 0?t:et,e=g(e!==void 0?e:y);const r=I(l),n=Z(l);i=i>0?i:Math.max(n/e[0],r/e[1]);const s=t+1,o=new Array(s);for(let a=0;a<s;++a)o[a]=i/Math.pow(2,a);return o}function at(l,t,e,i){const r=b(l);return lt(r,t,e,i)}function b(l){l=G(l);let t=l.getExtent();if(!t){const e=180*Y.degrees/l.getMetersPerUnit();t=C(-e,-e,e,e)}return t}const ut=/\{z\}/g,ct=/\{x\}/g,ht=/\{y\}/g,dt=/\{-y\}/g;function gt(l,t,e,i,r){return l.replace(ut,t.toString()).replace(ct,e.toString()).replace(ht,i.toString()).replace(dt,function(){if(r===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(r-i).toString()})}function ft(l){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(l);if(e){const i=e[1].charCodeAt(0),r=e[2].charCodeAt(0);let n;for(n=i;n<=r;++n)t.push(l.replace(e[0],String.fromCharCode(n)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(l),e){const i=parseInt(e[2],10);for(let r=parseInt(e[1],10);r<=i;r++)t.push(l.replace(e[0],r.toString()));return t}return t.push(l),t}function mt(l,t){return function(e,i,r){if(!e)return;let n;const s=e[0];if(t){const o=t.getFullTileRange(s);o&&(n=o.getHeight()-1)}return gt(l,s,e[1],e[2],n)}}function Tt(l,t){const e=l.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=mt(l[r],t);return xt(i)}function xt(l){return l.length===1?l[0]:function(t,e,i){if(!t)return;const r=N(t),n=rt(r,l.length);return l[n](t,e,i)}}class _t extends nt{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&g(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||E(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,r,n){return V()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:A(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const r=this.getTileGridForProjection(i),n=this.getTilePixelRatio(e),s=g(r.getTileSize(t),this.tmpSize);return n==1?s:K(s,n,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){const i=e!==void 0?e:this.getProjection(),r=e!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(t=st(r,t,i)),q(t,r)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class Ft extends J{constructor(t,e){super(t),this.tile=e}}const z={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class P extends _t{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===P.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=E(e),r=e.getState();let n;r==x.LOADING?(this.tileLoadingKeys_[i]=!0,n=z.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],n=r==x.ERROR?z.TILELOADERROR:r==x.LOADED?z.TILELOADEND:void 0),n!=null&&this.dispatchEvent(new Ft(n,e))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=ft(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Tt(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}}class Rt extends P{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Et,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:B,this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(t){return this.getProjection()&&t&&!S(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||S(e,t)))return this.tileGrid;const i=E(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=A(t)),this.tileGridForProjection[i]}createTile_(t,e,i,r,n,s){const o=[t,e,i],a=this.getTileCoordForTileUrlFunction(o,n),u=a?this.tileUrlFunction(a,r,n):void 0,c=new this.tileClass(o,u!==void 0?x.IDLE:x.EMPTY,u!==void 0?u:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=s,c.addEventListener(Q.CHANGE,this.handleTileChange.bind(this)),c}getTile(t,e,i,r,n){const s=this.getProjection();if(!s||!n||S(s,n))return this.getTileInternal(t,e,i,r,s||n);const o=[t,e,i],a=this.getKey(),u=this.getTileGridForProjection(s),c=this.getTileGridForProjection(n),h=this.getTileCoordForTileUrlFunction(o,n),_=new H(s,u,n,c,o,h,this.getTilePixelRatio(r),this.getGutter(),(U,X,w,M)=>this.getTileInternal(U,X,w,M,s),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return _.key=a,_}getTileInternal(t,e,i,r,n){const s=this.getKey();return this.createTile_(t,e,i,r,n,s)}setRenderReprojectionEdges(t){this.renderReprojectionEdges_!=t&&(this.renderReprojectionEdges_=t,this.changed())}setTileGridForProjection(t,e){const i=G(t);if(i){const r=E(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}}}function Et(l,t){l.getImage().src=t}class St extends Rt{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",i=t.tileGrid!==void 0?t.tileGrid:ot({extent:b(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const zt='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Xt extends St{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[zt];const i=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",r=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:r,wrapX:t.wrapX,zDirection:t.zDirection})}}export{zt as ATTRIBUTION,Xt as default};
