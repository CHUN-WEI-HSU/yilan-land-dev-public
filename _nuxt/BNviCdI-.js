const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DTEwTK4m.js","./Dutgce-t.js","./BBoprNr9.js","./CBsAYBMq.js","./D_uhChHx.js","./DGB6o809.js","./DENk7BAX.js","./NcfOxGOJ.js","./Db2rOhY5.js","./Ba_gg6Bw.js","./1jRA9jIJ.js","./DCo6-o3V.js","./BNCPP-Lc.js","./BAiuiMj1.js","./C3jLKcSw.js","./CiY_2Xgg.js","./Cc173s93.js","./BIaPAw8G.js","./DYcbPNs3.js","./D391rXv1.js","./CKUT-AdB.js","./DSor2vHC.js","./MGqbFZfO.js","./DO_F0CpN.js","./C1H55nfk.js","./BD0SBfHH.js","./jYV8uuws.js","./_zC-pxp2.js","./WJtrQfu8.js","./eOprcJGM.js","./A64qX3LD.js","./CviRnRtU.js","./ByTRVZRC.js","./XjPU5nHJ.js","./CHpdm47R.js","./DznvR31K.js","./C3uZdvdz.js","./B6UvNTut.js"])))=>i.map(i=>d[i]);
import{_ as te,O as Ee,f as N,r as y,h as ke,c as b,o as v,b as u,w as c,d as D,x as Se,U as G,a as s,F as S,K as ee,e as O,J as L,t as m,ai as _,T as ze,u as De,ah as Oe,i as Me,aj as $e}from"./D7mpKE92.js";import{u as Re,_ as Fe}from"./BAhXpk5I.js";import{V as ae}from"./BmNxzNe3.js";import{V as Be,a as We}from"./Bnj0Vu5i.js";import{A as we}from"./CUcIaLN8.js";import{d as j,V as Ue,a as je,b as Ne,c as M}from"./BtIzS7aj.js";import{c as Q}from"./B1nbOOus.js";import{q as be,t as Ve}from"./C6TErlTq.js";import{V as xe,a as Pe}from"./ZBLjeBBo.js";import{V as Ge}from"./C-NydD0m.js";import"./BbohOuBu.js";import"./DFAaa6OR.js";import"./vU-ZaTOM.js";import"./C84G2iSU.js";const Je={__name:"BaseMapSelector",emits:["basemap-changed"],setup($,{emit:n}){const{mdAndUp:A}=Ee(),I=N(()=>!A.value),f=[{label:"國土測繪中心電子地圖",value:"nlsc",url:"https://wmts.nlsc.gov.tw/wmts/EMAP5/default/EPSG:3857/{z}/{y}/{x}"},{label:"Google Map",value:"google",url:"https://mt1.google.com/vt/lyrs=m&hl=zh-TW&x={x}&y={y}&z={z}"},{label:"Google 衛星",value:"google-satellite",url:"https://mt1.google.com/vt/lyrs=s&hl=zh-TW&x={x}&y={y}&z={z}"}],P=y("nlsc"),V=n,E=g=>{const w=f.find(q=>q.value===g);w&&V("basemap-changed",w)};return ke(()=>{const g=f.find(w=>w.value===P.value);g&&V("basemap-changed",g)}),(g,w)=>(v(),b("div",{class:Se(["basemap-selector",{mobile:I.value}])},[u(Be,{modelValue:P.value,"onUpdate:modelValue":[w[0]||(w[0]=q=>P.value=q),E],items:f,"item-title":"label","item-value":"value",density:"compact","hide-details":"",variant:"outlined",class:"basemap-select","menu-props":{maxWidth:"300"}},{"prepend-inner":c(()=>[u(ae,{size:"small",color:"primary"},{default:c(()=>w[1]||(w[1]=[D(" mdi-layers ")])),_:1})]),_:1},8,["modelValue"])],2))}},He=te(Je,[["__scopeId","data-v-69720609"]]),Ye={class:"status-selector-container"},Ze={class:"status-selector"},Ke=["onClick"],Xe={class:"status-label"},Qe={__name:"StatusSelector",props:{modelValue:{type:Array,default:()=>[]},options:{type:Array,default:()=>[{label:"規劃中",value:"規劃中",color:"#a5b4fc"},{label:"辦理中",value:"辦理中",color:"#fdba74"},{label:"已完成",value:"已完成",color:"#f87171"}]}},emits:["update:modelValue","filter"],setup($,{emit:n}){const A=$,I=n,f=y(A.modelValue);G(()=>A.modelValue,V=>{f.value=V});const P=V=>{const E=f.value.indexOf(V);E===-1?f.value.push(V):f.value.splice(E,1),I("update:modelValue",f.value),I("filter",f.value)};return(V,E)=>(v(),b("div",Ye,[s("div",Ze,[(v(!0),b(S,null,ee($.options,g=>(v(),b("div",{key:g.value,class:Se(["status-item d-flex align-center justify-center ga-1",{"status-selected":f.value.includes(g.value)}]),onClick:w=>P(g.value)},[f.value.includes(g.value)?(v(),O(ae,{key:0,class:"status-check-icon",icon:"mdi-check-circle-outline"})):L("",!0),s("span",Xe,m(g.label),1)],10,Ke))),128))])]))}},et=te(Qe,[["__scopeId","data-v-629e5361"]]),tt={class:"lightbox-pagination"},at={class:"map-filters d-none d-md-block"},lt={class:"map-filters-mobile d-md-none"},st={key:0,class:"empty-selection"},nt={class:"empty-icon"},ot={class:"empty-title"},it={class:"empty-subtitle"},rt={key:1},ut={class:"location-header"},dt={class:"location-text text-white"},ct={class:"project-title"},vt={class:"status-chip"},ft={class:"info-grid"},mt={class:"info-value"},pt={class:"info-value"},_t={class:"info-value"},gt={class:"info-value"},ht={class:"info-value"},yt={class:"info-value"},wt={class:"info-value"},bt={class:"progress-container"},Vt={class:"text-white",style:{"text-shadow":"0 0 2px rgba(0,0,0,0.7)",opacity:"1"}},xt={class:"info-value"},Pt={class:"progress-container"},Et={class:"text-white",style:{"text-shadow":"0 0 2px rgba(0,0,0,0.7)",opacity:"1"}},kt={class:"info-value full-width-value"},St={class:"image-grid"},Lt={class:"info-value full-width-value"},At={class:"image-grid"},It={class:"info-value"},Ct={class:"button-group"},qt={__name:"map",setup($){const n=De(),A=Me(),I=Re(),f=t=>!t||typeof t!="string"?"":t.replace(/[<>'"&]/g,e=>({"<":"&lt;",">":"&gt;","'":"&#x27;",'"':"&quot;","&":"&amp;"})[e]||e).trim().slice(0,100),P=y(!1),V=y([]),E=y(0);let g,w,q,J,le,se,T,ne,oe,ie,re,ue,de,ce,ve,fe;const Le=async()=>{try{await I.fetchLandDevelopments()}catch(t){console.error("初始化地圖數據失敗:",t)}};ke(async()=>{await Le(),g=(await _(async()=>{const{default:a}=await import("./DTEwTK4m.js");return{default:a}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]),import.meta.url)).default,w=(await _(async()=>{const{default:a}=await import("./Db2rOhY5.js").then(r=>r.e);return{default:a}},__vite__mapDeps([8,2,3,7,9,10,11,12,13,14,15,16]),import.meta.url)).default,q=(await _(async()=>{const{default:a}=await import("./eOprcJGM.js");return{default:a}},__vite__mapDeps([29,30,5,3,6,11,10,9,12,14,7,21,31,18,24,8,2,13,15,16]),import.meta.url)).default,J=(await _(async()=>{const{default:a}=await import("./ByTRVZRC.js");return{default:a}},__vite__mapDeps([32,10,9,21,30,5,3,6,11,12,14,7,33,2]),import.meta.url)).default,le=(await _(async()=>{const{default:a}=await import("./CHpdm47R.js");return{default:a}},__vite__mapDeps([34,2,3,7]),import.meta.url)).default,se=(await _(async()=>{const{default:a}=await import("./BAiuiMj1.js").then(r=>r.b);return{default:a}},__vite__mapDeps([13,10,9,3,2,14,7,15]),import.meta.url)).default,{fromLonLat:T,toLonLat:ne}=await _(()=>import("./1jRA9jIJ.js").then(a=>a.a5),__vite__mapDeps([10,9]),import.meta.url),oe=(await _(async()=>{const{default:a}=await import("./DznvR31K.js");return{default:a}},__vite__mapDeps([35,8,2,3,7,9,10,11,12,13,14,15,16,5,24,17,18,19,20,21,22,23,31,27,25,26,28]),import.meta.url)).default,ie=(await _(async()=>{const{default:a}=await import("./C3uZdvdz.js");return{default:a}},__vite__mapDeps([36,1,2,3,7,10,9,16,12,15,14,26,33]),import.meta.url)).default,re=(await _(async()=>{const{default:a}=await import("./BIaPAw8G.js").then(r=>r.y);return{default:a}},__vite__mapDeps([17,7,18,5,3,9,19,2,20,21,22,23]),import.meta.url)).default,ue=(await _(async()=>{const{default:a}=await import("./_zC-pxp2.js");return{default:a}},__vite__mapDeps([27,18,5,3,9,7,19,20,21]),import.meta.url)).default,de=(await _(async()=>{const{default:a}=await import("./WJtrQfu8.js");return{default:a}},__vite__mapDeps([28,21,22,18,5,3,9,19]),import.meta.url)).default,ce=(await _(async()=>{const{default:a}=await import("./MGqbFZfO.js");return{default:a}},__vite__mapDeps([22,18,5,3,9,19]),import.meta.url)).default,ve=(await _(async()=>{const{default:a}=await import("./DO_F0CpN.js");return{default:a}},[],import.meta.url)).default,fe=(await _(()=>import("./B6UvNTut.js"),__vite__mapDeps([37,4,3,2]),import.meta.url)).default,h.value=qe(),ze(()=>{(n&&n.query&&n.query.search||n&&n.query&&n.query.region)&&W()});const e=n&&n.query&&n.query.id,d=n&&n.query&&n.query.search,o=n&&n.query&&n.query.region;if(e){const a=F.value.find(r=>r.id===parseInt(e));a&&ge(a)}else(d||o)&&he();window.addEventListener("resize",()=>{h.value&&h.value.updateSize()})}),Oe(()=>{window.removeEventListener("resize",()=>{}),h.value&&(h.value.setTarget(null),h.value=null)});const me=y(null),h=y(null),C=y(null),pe=y([]),H=y(null),{mdAndUp:R}=Ee(),Y=[{label:"規劃中",value:"規劃中",color:"#a5b4fc"},{label:"辦理中",value:"辦理中",color:"#fdba74"},{label:"已完成",value:"已完成",color:"#f87171"}],Z=y(null),_e=y(null),x=y([]),F=N(()=>I.landDevelopments.filter(t=>t.id&&t.name&&t.longitude&&t.latitude&&typeof t.longitude=="number"&&typeof t.latitude=="number").map(t=>({id:t.id,name:t.name,township:t.township,county:"宜蘭縣",method:t.developmentMethod,status:t.processingStatus,coordinates:[t.longitude,t.latitude],area:t.totalArea,timeline:t.timeline,organizer:"宜蘭縣政府",planningScope:t.planningScope,constructionProgress:t.constructionProgress||0,estimatedProgress:t.estimatedProgress||0,siteCondition:t.siteCondition||[],aerialPhoto:t.aerialPhoto||[],preliminaryWork:t.preliminaryWork||[],planApproval:t.planApproval||[]}))),z=N(()=>{let t=[...F.value];const e=n&&n.query&&n.query.search,d=n&&n.query&&n.query.region;if(e){const o=f(e);if(o){const a=o.toLowerCase();t=t.filter(r=>r.name.toLowerCase().includes(a)||r.township.toLowerCase().includes(a))}}if(d){const o=f(d);we.includes(o)&&(t=t.filter(a=>a.township===o))}return _e.value&&(t=t.filter(o=>o.status===_e.value)),x.value&&x.value.length>0&&(t=t.filter(o=>x.value.includes(o.status))),t}),l=y(null),K=N(()=>{const t=n&&n.query&&n.query.search||n&&n.query&&n.query.region,e=z.value.length>0;return t&&!e?"no-results":!l.value&&e?"no-selection":!l.value&&!t?"initial":"selected"}),ge=t=>{l.value=t,A.push({path:n.path,query:{...n.query||{},id:t.id}}),C.value&&C.value.changed(),h.value&&h.value.getView().animate({center:T(t.coordinates),zoom:R.value?15:14,duration:1e3})},he=()=>{z.value.length===0&&(l.value=null)},Ae=()=>{switch(K.value){case"no-results":return"查無相關開發案";case"no-selection":return"請先選擇開發案";default:return"請先選擇開發案"}},Ie=()=>{switch(K.value){case"no-results":{const t=f(n&&n.query&&n.query.search),e=f(n&&n.query&&n.query.region);let d="找不到符合條件的開發案";const o=[];if(t&&e?o.push(`「${t}」在「${e}」`):t?o.push(`「${t}」`):e&&o.push(`「${e}」`),x.value&&x.value.length>0){const a=x.value.map(r=>{const i=Y.find(p=>p.value===r);return i?i.label:r}).join("、");o.push(`狀態「${a}」`)}return o.length>0&&(d+=`：${o.join("，")}`),d+"，請調整搜尋條件"}case"no-selection":return"點擊地圖上的標記以查看詳細資訊";default:return"點擊地圖上的標記以查看詳細資訊"}},B=t=>{if(!(!t||t.length===0)){if(t.length===1&&(t[0].type==="pdf"||typeof t[0]=="string"&&t[0].includes(".pdf"))){window.open(t[0].url||t[0],"_blank");return}V.value=t.map(e=>typeof e=="string"?{src:e}:{src:e.url||e.src||e,title:e.title||""}),E.value=0,P.value=!0}},ye=()=>{W()},Ce=t=>{if(!h.value||!H.value)return;const e=new J({url:t.url});H.value.setSource(e)},W=()=>{if(!(!h.value||!C.value)&&(C.value.changed(),!l.value)){const t=pe.value.filter(e=>{const d=e.get("data");return z.value.some(o=>o.id===d.id)});if(t.length>0){const e=t.reduce((d,o)=>{const r=o.getGeometry().getExtent();return d?[Math.min(d[0],r[0]),Math.min(d[1],r[1]),Math.max(d[2],r[2]),Math.max(d[3],r[3])]:r},null);e&&h.value.getView().fit(e,{padding:[100,50,50,50],maxZoom:18,duration:1e3})}else h.value.getView().animate({center:T([121.76,24.75]),zoom:R.value?12:10,duration:1e3})}},qe=()=>{const t=F.value.map(i=>new le({geometry:new se(T(i.coordinates)),data:i}));pe.value=t;const e=new ie({features:t}),d=new oe({source:e,style:i=>{const p=i.get("data");if(!p||!z.value.some(X=>X.id===p.id))return null;const U=l.value&&l.value.id===p.id;return new re({image:new ue({src:"icons/marker.png",width:25}),text:new de({text:p.name,offsetY:-20,font:"bold 12px Arial",fill:new ce({color:U?"#f5a623":"#2a2ace"}),stroke:new ve({color:"#FFFFFF",width:3}),padding:[3,3,3,3]}),zIndex:U?2:1})}});C.value=d;const o=new q({source:new J({url:"https://wmts.nlsc.gov.tw/wmts/EMAP5/default/EPSG:3857/{z}/{y}/{x}"})});H.value=o;const a=new g({target:me.value,layers:[o,d],view:new w({center:T([121.76,24.75]),zoom:R.value?12:10})}),r=new fe({width:170,defaultItems:!1,items:[{text:"查詢地籍",classname:"land-query-item",callback:function(i,p){const k=ne(i.coordinate),[U,X]=k,Te=`https://house.e-land.gov.tw/map/#/?lc=${X},${U}`;window.open(Te,"_blank")}}]});return a.addControl(r),a.on("click",i=>{const p=a.forEachFeatureAtPixel(i.pixel,k=>k);if(p){const k=p.get("data");k&&ge(k)}}),a};return G(z,()=>{if(W(),l.value&&!z.value.some(t=>t.id===l.value.id)){l.value=null;const t={...n.query};delete t.id,A.push({path:n.path,query:t})}he()},{deep:!0}),G(l,()=>{C.value&&C.value.changed()}),G(()=>n&&n.query?n.query:{},(t,e)=>{if(t=t||{},e=e||{},JSON.stringify(t)!==JSON.stringify(e)){const d=t.id,o=t.region;if(d&&d!==e.id){const r=F.value.find(i=>i.id===parseInt(d));r&&(l.value=r,h.value&&h.value.getView().animate({center:T(r.coordinates),zoom:R.value?15:14,duration:1e3}))}e.id&&!d&&(l.value=null,W());const a=f(o);a?we.includes(a)?Z.value=a:Z.value=null:!t.region&&e.region&&(Z.value=null),!d&&!t.search&&!t.region&&(e.id||e.search||e.region)&&(l.value=null)}},{immediate:!0}),(t,e)=>{const d=$e("vue-easy-lightbox"),o=Fe,a=He,r=et;return v(),O(Ge,{fluid:"",class:"pa-0"},{default:c(()=>[u(o,null,{default:c(()=>[u(d,{visible:P.value,imgs:V.value,index:E.value,onHide:e[0]||(e[0]=i=>P.value=!1)},{pagination:c(()=>[s("div",tt,m(E.value+1)+" / "+m(V.value.length),1)]),_:1},8,["visible","imgs","index"])]),_:1}),u(M,{"no-gutters":"",class:"land-development-container"},{default:c(()=>[u(j,{cols:"12",md:"6",class:"map-section"},{default:c(()=>[s("div",{ref_key:"mapElement",ref:me,class:"map-element"},null,512),u(a,{onBasemapChanged:Ce}),s("div",at,[u(r,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=i=>x.value=i),options:Y,onFilter:ye},null,8,["modelValue"])]),s("div",lt,[u(r,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=i=>x.value=i),options:Y,onFilter:ye},null,8,["modelValue"])])]),_:1}),u(j,{cols:"12",md:"6",class:"info-section pa-5"},{default:c(()=>[l.value?(v(),b("div",rt,[s("div",ut,[s("div",null,[s("span",dt,m(l.value.county)+" | "+m(l.value.township),1)])]),s("h1",ct,m(l.value.name),1),s("div",vt,[u(We,{class:"bg-white",color:"orange",size:t.$vuetify.display.mdAndUp?"default":"small"},{default:c(()=>[D(m(l.value.status),1)]),_:1},8,["size"])]),u(Ue,{class:"mt-4"},{default:c(()=>[u(je,{class:"info-title"},{default:c(()=>[e[7]||(e[7]=D(" 基本資訊 ")),u(Q,{class:"mt-2"})]),_:1}),u(Ne,null,{default:c(()=>[s("div",ft,[e[15]||(e[15]=s("div",{class:"info-label"}," 土地開發名稱： ",-1)),s("div",mt,m(l.value.name),1),e[16]||(e[16]=s("div",{class:"info-label"}," 鄉鎮市區： ",-1)),s("div",pt,m(l.value.township),1),e[17]||(e[17]=s("div",{class:"info-label"}," 開發方式： ",-1)),s("div",_t,m(l.value.method),1),e[18]||(e[18]=s("div",{class:"info-label"}," 辦理情形： ",-1)),s("div",gt,m(l.value.status),1),e[19]||(e[19]=s("div",{class:"info-label"}," 開發總面積： ",-1)),s("div",ht,m(l.value.area)+" 公頃 ",1),e[20]||(e[20]=s("div",{class:"info-label"}," 開發期程： ",-1)),s("div",yt,m(l.value.timeline),1),e[21]||(e[21]=s("div",{class:"info-label"}," 主辦單位： ",-1)),e[22]||(e[22]=s("div",{class:"info-value"}," 宜蘭縣政府 ",-1)),l.value.constructionProgress!==void 0?(v(),b(S,{key:0},[e[8]||(e[8]=s("div",{class:"info-label"}," 施工進度： ",-1)),s("div",wt,[s("div",bt,[u(be,{"model-value":l.value.constructionProgress,color:"primary",height:"20",rounded:"",class:"mb-1"},{default:c(({value:i})=>[s("strong",Vt,m(Math.ceil(i))+"%",1)]),_:1},8,["model-value"])])])],64)):L("",!0),l.value.estimatedProgress!==void 0?(v(),b(S,{key:1},[e[9]||(e[9]=s("div",{class:"info-label"}," 預估進度： ",-1)),s("div",xt,[s("div",Pt,[u(be,{"model-value":l.value.estimatedProgress,color:"secondary",height:"20",rounded:"",class:"mb-1"},{default:c(({value:i})=>[s("strong",Et,m(Math.ceil(i))+"%",1)]),_:1},8,["model-value"])])])],64)):L("",!0),l.value.siteCondition&&l.value.siteCondition.length>0?(v(),b(S,{key:2},[e[10]||(e[10]=s("div",{class:"info-label full-width-label"}," 基地現況 ",-1)),s("div",kt,[u(Q,{class:"mb-3"}),s("div",St,[u(M,{class:"mb-2"},{default:c(()=>[(v(!0),b(S,null,ee(l.value.siteCondition.slice(0,2),(i,p)=>(v(),O(j,{key:p,cols:"6",sm:"6",md:"6",class:"pa-1"},{default:c(()=>[u(Ve,{src:i,alt:`基地現況 ${p+1}`,height:"120",cover:"",class:"rounded cursor-pointer",onClick:e[3]||(e[3]=k=>B(l.value.siteCondition))},{placeholder:c(()=>[u(M,{class:"fill-height ma-0",align:"center",justify:"center"},{default:c(()=>[u(Pe,{size:"20",indeterminate:"",color:"grey-lighten-5"})]),_:1})]),_:2},1032,["src","alt"])]),_:2},1024))),128))]),_:1})])])],64)):L("",!0),l.value.aerialPhoto&&l.value.aerialPhoto.length>0?(v(),b(S,{key:3},[e[11]||(e[11]=s("div",{class:"info-label full-width-label"}," 空拍圖 ",-1)),s("div",Lt,[u(Q,{class:"mb-3"}),s("div",At,[u(M,{class:"mb-2"},{default:c(()=>[(v(!0),b(S,null,ee(l.value.aerialPhoto.slice(0,2),(i,p)=>(v(),O(j,{key:p,cols:"6",sm:"6",md:"6",class:"pa-1"},{default:c(()=>[u(Ve,{src:i,alt:`空拍圖 ${p+1}`,height:"120",cover:"",class:"rounded cursor-pointer",onClick:e[4]||(e[4]=k=>B(l.value.aerialPhoto))},{placeholder:c(()=>[u(M,{class:"fill-height ma-0",align:"center",justify:"center"},{default:c(()=>[u(Pe,{size:"20",indeterminate:"",color:"grey-lighten-5"})]),_:1})]),_:2},1032,["src","alt"])]),_:2},1024))),128))]),_:1})])])],64)):L("",!0),l.value.preliminaryWork&&l.value.preliminaryWork.length>0||l.value.planApproval&&l.value.planApproval.length>0?(v(),b(S,{key:4},[e[14]||(e[14]=s("div",{class:"info-label"}," 相關資料： ",-1)),s("div",It,[s("div",Ct,[l.value.preliminaryWork&&l.value.preliminaryWork.length>0?(v(),O(xe,{key:0,color:"primary",size:"small",class:"mr-2 mb-2",onClick:e[5]||(e[5]=i=>B(l.value.preliminaryWork))},{default:c(()=>e[12]||(e[12]=[D(" 先行作業 ")])),_:1})):L("",!0),l.value.planApproval&&l.value.planApproval.length>0?(v(),O(xe,{key:1,color:"primary",size:"small",class:"mb-2",onClick:e[6]||(e[6]=i=>B(l.value.planApproval))},{default:c(()=>e[13]||(e[13]=[D(" 計劃核准 ")])),_:1})):L("",!0)])])],64)):L("",!0)])]),_:1})]),_:1})])):(v(),b("div",st,[s("div",nt,[u(ae,{size:"80",color:"white"},{default:c(()=>[D(m(K.value==="no-results"?"mdi-magnify-close":"mdi-map-marker-outline"),1)]),_:1})]),s("h2",ot,m(Ae()),1),s("p",it,m(Ie()),1)]))]),_:1})]),_:1})]),_:1})}}},Jt=te(qt,[["__scopeId","data-v-ec5afb05"]]);export{Jt as default};
