import{l as N,r as d,h as g,c as P,b as t,w as o,d as V,k as S,o as T}from"./CtiptTIU.js";import{u as x}from"./CZo5CsfA.js";import{V as k,a as q,c as C,d as c}from"./B7bkZI78.js";import{V as I}from"./Bi8knA0y.js";import{V as _}from"./NwnemnFG.js";import{V as B}from"./BqdUcUm8.js";import{V as M}from"./BBl5NXvx.js";import{V as O}from"./v5m7S0p5.js";import"./DIhnNZwz.js";import"./CgiVEhsX.js";let r={newCompletionCount:5,chartUpdateDate:new Date().toISOString().split("T")[0],adminNotes:"Default admin notes for land development parameters"};const y={getList:async u=>(await new Promise(l=>setTimeout(l,300)),{code:200,message:"success",data:{data:[{id:1,key:"new_completion_count",name:"新完工案件數",value:r.newCompletionCount,chartUpdateDate:r.chartUpdateDate,note:r.adminNotes,category:"chart_statistics",type:"number"}],total:1}}),create:async u=>(await new Promise(l=>setTimeout(l,500)),r={newCompletionCount:u.value||r.newCompletionCount,chartUpdateDate:u.chartUpdateDate||r.chartUpdateDate,adminNotes:u.note||r.adminNotes},{code:200,message:"Parameter created successfully",data:{id:1,...u}}),update:async(u,l)=>(await new Promise(p=>setTimeout(p,500)),r={newCompletionCount:l.value||r.newCompletionCount,chartUpdateDate:l.chartUpdateDate||r.chartUpdateDate,adminNotes:l.note||r.adminNotes},{code:200,message:"Parameter updated successfully",data:{id:u,...l}})},R={class:"parameters-management"},Q=N({__name:"index",setup(u){const{showSuccess:l,showError:p}=x(),D=d(!1),f=d(!1),v=d(!1),h=d(),i=d(null),n=d({value:"5",chartUpdateDate:new Date().toISOString().split("T")[0],note:""}),w={required:a=>!!a||"此欄位為必填",number:a=>{if(!a)return!0;const e=Number(a);return!isNaN(e)&&e>=0||"請輸入有效的非負數字"}},U=async()=>{var a,e,s;D.value=!0;try{const m=await y.getList({key:"new_completion_count"});m.data.data&&m.data.data.length>0&&(i.value=m.data.data[0],n.value={value:String(((a=i.value)==null?void 0:a.value)||5),chartUpdateDate:((e=i.value)==null?void 0:e.chartUpdateDate)||new Date().toISOString().split("T")[0],note:((s=i.value)==null?void 0:s.note)||""})}catch(m){console.error("載入參數失敗:",m),p("載入參數數據失敗")}finally{D.value=!1}},b=async()=>{var a;if((a=h.value)!=null&&a.validate()){f.value=!0;try{const e={key:"new_completion_count",name:"新完工案件數",value:Number(n.value.value),chartUpdateDate:n.value.chartUpdateDate,note:n.value.note,category:"chart_statistics",type:"number"};i.value?await y.update(i.value.id,e):await y.create(e),l("參數設定已成功儲存"),await U()}catch(e){console.error("儲存參數失敗:",e),p("參數設定儲存失敗")}finally{f.value=!1}}};return g(()=>{U()}),g(()=>{}),(a,e)=>(T(),P("div",R,[t(k,{class:"pa-4"},{default:o(()=>[t(q,{class:"text-h6 mb-4"},{default:o(()=>e[4]||(e[4]=[V(" 新完工案件數設定 ")])),_:1}),t(I,{ref_key:"formRef",ref:h,modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=s=>v.value=s),onSubmit:S(b,["prevent"])},{default:o(()=>[t(C,null,{default:o(()=>[t(c,{cols:"12",md:"6"},{default:o(()=>[t(_,{modelValue:n.value.value,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value.value=s),label:"新完工案件數",type:"number",rules:[w.required,w.number],variant:"outlined",hint:"請輸入新完工案件數量","persistent-hint":"",required:""},null,8,["modelValue","rules"])]),_:1}),t(c,{cols:"12",md:"6"},{default:o(()=>[t(_,{modelValue:n.value.chartUpdateDate,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.chartUpdateDate=s),label:"圖表更新日期",type:"date",rules:[w.required],variant:"outlined",hint:"請選擇圖表數據的更新日期","persistent-hint":"",required:""},null,8,["modelValue","rules"])]),_:1}),t(c,{cols:"12"},{default:o(()=>[t(B,{modelValue:n.value.note,"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.note=s),label:"管理者備註",rows:"4",variant:"outlined",hint:"此備註僅供管理者參考，不會顯示在前端","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1}),t(C,{class:"mt-4"},{default:o(()=>[t(c,{cols:"12",class:"d-flex justify-end"},{default:o(()=>[t(M,{color:"primary",type:"submit",loading:f.value,disabled:!v.value,size:"large"},{default:o(()=>[t(O,{start:""},{default:o(()=>e[5]||(e[5]=[V(" mdi-content-save ")])),_:1}),e[6]||(e[6]=V(" 儲存設定 "))]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]))}});export{Q as default};
