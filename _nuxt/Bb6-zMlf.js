const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DTEwTK4m.js","./Dutgce-t.js","./BBoprNr9.js","./CBsAYBMq.js","./D_uhChHx.js","./DGB6o809.js","./DENk7BAX.js","./NcfOxGOJ.js","./Db2rOhY5.js","./Ba_gg6Bw.js","./1jRA9jIJ.js","./DCo6-o3V.js","./BNCPP-Lc.js","./BAiuiMj1.js","./C3jLKcSw.js","./CiY_2Xgg.js","./Cc173s93.js","./BIaPAw8G.js","./DYcbPNs3.js","./D391rXv1.js","./CKUT-AdB.js","./DSor2vHC.js","./MGqbFZfO.js","./DO_F0CpN.js","./C1H55nfk.js","./BD0SBfHH.js","./jYV8uuws.js","./_zC-pxp2.js","./WJtrQfu8.js","./eOprcJGM.js","./A64qX3LD.js","./CviRnRtU.js","./ByTRVZRC.js","./XjPU5nHJ.js","./CHpdm47R.js","./DznvR31K.js","./C3uZdvdz.js","./B6UvNTut.js"])))=>i.map(i=>d[i]);
import{_ as Q,O as Ve,f as j,r as y,h as Pe,c as b,o as v,b as u,w as c,d as D,x as Ee,U as N,a as s,F as k,K as X,e as O,J as S,t as m,ai as _,T as qe,u as Te,ah as ze,i as De,aj as Oe}from"./3XD3FR9c.js";import{u as Me,_ as Re}from"./5hgeif51.js";import{V as ee}from"./By4tviDR.js";import{V as $e,a as Fe}from"./BmMGbPsy.js";import{A as he}from"./CUcIaLN8.js";import{d as U,V as Be,a as We,b as Ue,c as M}from"./BMDZv5t9.js";import{c as K}from"./CqWArBya.js";import{q as ye,t as we}from"./Div-U7uV.js";import{V as be,a as xe}from"./CqHuFSZz.js";import{V as je}from"./Bm3HGFj5.js";import"./BbohOuBu.js";import"./C4qiHA3n.js";import"./C5WZkcU-.js";import"./BC2FVrgw.js";const Ne={__name:"BaseMapSelector",emits:["basemap-changed"],setup(R,{emit:n}){const{mdAndUp:L}=Ve(),A=j(()=>!L.value),f=[{label:"國土測繪中心電子地圖",value:"nlsc",url:"https://wmts.nlsc.gov.tw/wmts/EMAP5/default/EPSG:3857/{z}/{y}/{x}"},{label:"Google Map",value:"google",url:"https://mt1.google.com/vt/lyrs=m&hl=zh-TW&x={x}&y={y}&z={z}"},{label:"Google 衛星",value:"google-satellite",url:"https://mt1.google.com/vt/lyrs=s&hl=zh-TW&x={x}&y={y}&z={z}"}],P=y("nlsc"),x=n,E=g=>{const w=f.find(q=>q.value===g);w&&x("basemap-changed",w)};return Pe(()=>{const g=f.find(w=>w.value===P.value);g&&x("basemap-changed",g)}),(g,w)=>(v(),b("div",{class:Ee(["basemap-selector",{mobile:A.value}])},[u($e,{modelValue:P.value,"onUpdate:modelValue":[w[0]||(w[0]=q=>P.value=q),E],items:f,"item-title":"label","item-value":"value",density:"compact","hide-details":"",variant:"outlined",class:"basemap-select","menu-props":{maxWidth:"300"}},{"prepend-inner":c(()=>[u(ee,{size:"small",color:"primary"},{default:c(()=>w[1]||(w[1]=[D(" mdi-layers ")])),_:1})]),_:1},8,["modelValue"])],2))}},Ge=Q(Ne,[["__scopeId","data-v-db6d4000"]]),Je={class:"status-selector-container"},He={class:"status-selector"},Ye=["onClick"],Ze={class:"status-label"},Ke={__name:"StatusSelector",props:{modelValue:{type:Array,default:()=>[]},options:{type:Array,default:()=>[{label:"規劃中",value:"規劃中",color:"#a5b4fc"},{label:"辦理中",value:"辦理中",color:"#fdba74"},{label:"已完成",value:"已完成",color:"#f87171"}]}},emits:["update:modelValue","filter"],setup(R,{emit:n}){const L=R,A=n,f=y(L.modelValue);N(()=>L.modelValue,x=>{f.value=x});const P=x=>{const E=f.value.indexOf(x);E===-1?f.value.push(x):f.value.splice(E,1),A("update:modelValue",f.value),A("filter",f.value)};return(x,E)=>(v(),b("div",Je,[s("div",He,[(v(!0),b(k,null,X(R.options,g=>(v(),b("div",{key:g.value,class:Ee(["status-item d-flex align-center justify-center ga-1",{"status-selected":f.value.includes(g.value)}]),onClick:w=>P(g.value)},[f.value.includes(g.value)?(v(),O(ee,{key:0,class:"status-check-icon",icon:"mdi-check-circle-outline"})):S("",!0),s("span",Ze,m(g.label),1)],10,Ye))),128))])]))}},Xe=Q(Ke,[["__scopeId","data-v-629e5361"]]),Qe={class:"lightbox-pagination"},et={class:"map-filters d-none d-md-block"},tt={class:"map-filters-mobile d-md-none"},at={key:0,class:"empty-selection"},lt={class:"empty-icon"},st={class:"empty-title"},nt={class:"empty-subtitle"},ot={key:1},it={class:"location-header"},rt={class:"location-text text-white"},ut={class:"project-title"},dt={class:"status-chip"},ct={class:"info-grid"},vt={class:"info-value"},ft={class:"info-value"},mt={class:"info-value"},pt={class:"info-value"},_t={class:"info-value"},gt={class:"info-value"},ht={class:"info-value"},yt={class:"progress-container"},wt={class:"text-white",style:{"text-shadow":"0 0 2px rgba(0,0,0,0.7)",opacity:"1"}},bt={class:"info-value"},xt={class:"progress-container"},Vt={class:"text-white",style:{"text-shadow":"0 0 2px rgba(0,0,0,0.7)",opacity:"1"}},Pt={class:"info-value full-width-value"},Et={class:"image-grid"},kt={class:"info-value full-width-value"},St={class:"image-grid"},Lt={class:"info-value"},At={class:"button-group"},Ct={__name:"map",setup(R){const n=Te(),L=De(),A=Me(),f=t=>!t||typeof t!="string"?"":t.replace(/[<>'"&]/g,e=>({"<":"&lt;",">":"&gt;","'":"&#x27;",'"':"&quot;","&":"&amp;"})[e]||e).trim().slice(0,100),P=y(!1),x=y([]),E=y(0);let g,w,q,G,te,ae,T,le,se,ne,oe,ie,re,ue,de;const ke=async()=>{try{await A.fetchLandDevelopments()}catch(t){console.error("初始化地圖數據失敗:",t)}};Pe(async()=>{await ke(),g=(await _(async()=>{const{default:a}=await import("./DTEwTK4m.js");return{default:a}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]),import.meta.url)).default,w=(await _(async()=>{const{default:a}=await import("./Db2rOhY5.js").then(i=>i.e);return{default:a}},__vite__mapDeps([8,2,3,7,9,10,11,12,13,14,15,16]),import.meta.url)).default,q=(await _(async()=>{const{default:a}=await import("./eOprcJGM.js");return{default:a}},__vite__mapDeps([29,30,5,3,6,11,10,9,12,14,7,21,31,18,24,8,2,13,15,16]),import.meta.url)).default,G=(await _(async()=>{const{default:a}=await import("./ByTRVZRC.js");return{default:a}},__vite__mapDeps([32,10,9,21,30,5,3,6,11,12,14,7,33,2]),import.meta.url)).default,te=(await _(async()=>{const{default:a}=await import("./CHpdm47R.js");return{default:a}},__vite__mapDeps([34,2,3,7]),import.meta.url)).default,ae=(await _(async()=>{const{default:a}=await import("./BAiuiMj1.js").then(i=>i.b);return{default:a}},__vite__mapDeps([13,10,9,3,2,14,7,15]),import.meta.url)).default,{fromLonLat:T}=await _(()=>import("./1jRA9jIJ.js").then(a=>a.a5),__vite__mapDeps([10,9]),import.meta.url),le=(await _(async()=>{const{default:a}=await import("./DznvR31K.js");return{default:a}},__vite__mapDeps([35,8,2,3,7,9,10,11,12,13,14,15,16,5,24,17,18,19,20,21,22,23,31,27,25,26,28]),import.meta.url)).default,se=(await _(async()=>{const{default:a}=await import("./C3uZdvdz.js");return{default:a}},__vite__mapDeps([36,1,2,3,7,10,9,16,12,15,14,26,33]),import.meta.url)).default,ne=(await _(async()=>{const{default:a}=await import("./BIaPAw8G.js").then(i=>i.y);return{default:a}},__vite__mapDeps([17,7,18,5,3,9,19,2,20,21,22,23]),import.meta.url)).default,oe=(await _(async()=>{const{default:a}=await import("./_zC-pxp2.js");return{default:a}},__vite__mapDeps([27,18,5,3,9,7,19,20,21]),import.meta.url)).default,ie=(await _(async()=>{const{default:a}=await import("./WJtrQfu8.js");return{default:a}},__vite__mapDeps([28,21,22,18,5,3,9,19]),import.meta.url)).default,re=(await _(async()=>{const{default:a}=await import("./MGqbFZfO.js");return{default:a}},__vite__mapDeps([22,18,5,3,9,19]),import.meta.url)).default,ue=(await _(async()=>{const{default:a}=await import("./DO_F0CpN.js");return{default:a}},[],import.meta.url)).default,de=(await _(()=>import("./B6UvNTut.js"),__vite__mapDeps([37,4,3,2]),import.meta.url)).default,h.value=Ce(),qe(()=>{(n&&n.query&&n.query.search||n&&n.query&&n.query.region)&&W()});const e=n&&n.query&&n.query.id,d=n&&n.query&&n.query.search,o=n&&n.query&&n.query.region;if(e){const a=F.value.find(i=>i.id===parseInt(e));a&&me(a)}else(d||o)&&pe();window.addEventListener("resize",()=>{h.value&&h.value.updateSize()})}),ze(()=>{window.removeEventListener("resize",()=>{}),h.value&&(h.value.setTarget(null),h.value=null)});const ce=y(null),h=y(null),C=y(null),ve=y([]),J=y(null),{mdAndUp:$}=Ve(),H=[{label:"規劃中",value:"規劃中",color:"#a5b4fc"},{label:"辦理中",value:"辦理中",color:"#fdba74"},{label:"已完成",value:"已完成",color:"#f87171"}],Y=y(null),fe=y(null),V=y([]),F=j(()=>A.landDevelopments.filter(t=>t.id&&t.name&&t.longitude&&t.latitude&&typeof t.longitude=="number"&&typeof t.latitude=="number").map(t=>({id:t.id,name:t.name,township:t.township,county:"宜蘭縣",method:t.developmentMethod,status:t.processingStatus,coordinates:[t.longitude,t.latitude],area:t.totalArea,timeline:t.timeline,organizer:"宜蘭縣政府",planningScope:t.planningScope,constructionProgress:t.constructionProgress||0,estimatedProgress:t.estimatedProgress||0,siteCondition:t.siteCondition||[],aerialPhoto:t.aerialPhoto||[],preliminaryWork:t.preliminaryWork||[],planApproval:t.planApproval||[]}))),z=j(()=>{let t=[...F.value];const e=n&&n.query&&n.query.search,d=n&&n.query&&n.query.region;if(e){const o=f(e);if(o){const a=o.toLowerCase();t=t.filter(i=>i.name.toLowerCase().includes(a)||i.township.toLowerCase().includes(a))}}if(d){const o=f(d);he.includes(o)&&(t=t.filter(a=>a.township===o))}return fe.value&&(t=t.filter(o=>o.status===fe.value)),V.value&&V.value.length>0&&(t=t.filter(o=>V.value.includes(o.status))),t}),l=y(null),Z=j(()=>{const t=n&&n.query&&n.query.search||n&&n.query&&n.query.region,e=z.value.length>0;return t&&!e?"no-results":!l.value&&e?"no-selection":!l.value&&!t?"initial":"selected"}),me=t=>{l.value=t,L.push({path:n.path,query:{...n.query||{},id:t.id}}),C.value&&C.value.changed(),h.value&&h.value.getView().animate({center:T(t.coordinates),zoom:$.value?15:14,duration:1e3})},pe=()=>{z.value.length===0&&(l.value=null)},Se=()=>{switch(Z.value){case"no-results":return"查無相關開發案";case"no-selection":return"請先選擇開發案";default:return"請先選擇開發案"}},Le=()=>{switch(Z.value){case"no-results":{const t=f(n&&n.query&&n.query.search),e=f(n&&n.query&&n.query.region);let d="找不到符合條件的開發案";const o=[];if(t&&e?o.push(`「${t}」在「${e}」`):t?o.push(`「${t}」`):e&&o.push(`「${e}」`),V.value&&V.value.length>0){const a=V.value.map(i=>{const r=H.find(p=>p.value===i);return r?r.label:i}).join("、");o.push(`狀態「${a}」`)}return o.length>0&&(d+=`：${o.join("，")}`),d+"，請調整搜尋條件"}case"no-selection":return"點擊地圖上的標記以查看詳細資訊";default:return"點擊地圖上的標記以查看詳細資訊"}},B=t=>{if(!(!t||t.length===0)){if(t.length===1&&(t[0].type==="pdf"||typeof t[0]=="string"&&t[0].includes(".pdf"))){window.open(t[0].url||t[0],"_blank");return}x.value=t.map(e=>typeof e=="string"?{src:e}:{src:e.url||e.src||e,title:e.title||""}),E.value=0,P.value=!0}},_e=()=>{W()},Ae=t=>{if(!h.value||!J.value)return;const e=new G({url:t.url});J.value.setSource(e)},W=()=>{if(!(!h.value||!C.value)&&(C.value.changed(),!l.value)){const t=ve.value.filter(e=>{const d=e.get("data");return z.value.some(o=>o.id===d.id)});if(t.length>0){const e=t.reduce((d,o)=>{const i=o.getGeometry().getExtent();return d?[Math.min(d[0],i[0]),Math.min(d[1],i[1]),Math.max(d[2],i[2]),Math.max(d[3],i[3])]:i},null);e&&h.value.getView().fit(e,{padding:[100,50,50,50],maxZoom:18,duration:1e3})}else h.value.getView().animate({center:T([121.76,24.75]),zoom:$.value?12:10,duration:1e3})}},Ce=()=>{const t=F.value.map(r=>new te({geometry:new ae(T(r.coordinates)),data:r}));ve.value=t;const e=new se({features:t}),d=new le({source:e,style:r=>{const p=r.get("data");if(!p||!z.value.some(Ie=>Ie.id===p.id))return null;const ge=l.value&&l.value.id===p.id;return new ne({image:new oe({src:"icons/marker.png",width:25}),text:new ie({text:p.name,offsetY:-20,font:"bold 12px Arial",fill:new re({color:ge?"#f5a623":"#2a2ace"}),stroke:new ue({color:"#FFFFFF",width:3}),padding:[3,3,3,3]}),zIndex:ge?2:1})}});C.value=d;const o=new q({source:new G({url:"https://wmts.nlsc.gov.tw/wmts/EMAP5/default/EPSG:3857/{z}/{y}/{x}"})});J.value=o;const a=new g({target:ce.value,layers:[o,d],view:new w({center:T([121.76,24.75]),zoom:$.value?12:10})}),i=new de({width:170,defaultItems:!1,items:[{text:"查詢地籍",classname:"land-query-item",callback:function(r,p){console.log("Context menu clicked, opening land query..."),window.open("https://house.e-land.gov.tw/map/#/","_blank")}}]});return a.addControl(i),a.on("click",r=>{const p=a.forEachFeatureAtPixel(r.pixel,I=>I);if(p){const I=p.get("data");I&&me(I)}}),a};return N(z,()=>{if(W(),l.value&&!z.value.some(t=>t.id===l.value.id)){l.value=null;const t={...n.query};delete t.id,L.push({path:n.path,query:t})}pe()},{deep:!0}),N(l,()=>{C.value&&C.value.changed()}),N(()=>n&&n.query?n.query:{},(t,e)=>{if(t=t||{},e=e||{},JSON.stringify(t)!==JSON.stringify(e)){const d=t.id,o=t.region;if(d&&d!==e.id){const i=F.value.find(r=>r.id===parseInt(d));i&&(l.value=i,h.value&&h.value.getView().animate({center:T(i.coordinates),zoom:$.value?15:14,duration:1e3}))}e.id&&!d&&(l.value=null,W());const a=f(o);a?he.includes(a)?Y.value=a:Y.value=null:!t.region&&e.region&&(Y.value=null),!d&&!t.search&&!t.region&&(e.id||e.search||e.region)&&(l.value=null)}},{immediate:!0}),(t,e)=>{const d=Oe("vue-easy-lightbox"),o=Re,a=Ge,i=Xe;return v(),O(je,{fluid:"",class:"pa-0"},{default:c(()=>[u(o,null,{default:c(()=>[u(d,{visible:P.value,imgs:x.value,index:E.value,onHide:e[0]||(e[0]=r=>P.value=!1)},{pagination:c(()=>[s("div",Qe,m(E.value+1)+" / "+m(x.value.length),1)]),_:1},8,["visible","imgs","index"])]),_:1}),u(M,{"no-gutters":"",class:"land-development-container"},{default:c(()=>[u(U,{cols:"12",md:"6",class:"map-section"},{default:c(()=>[s("div",{ref_key:"mapElement",ref:ce,class:"map-element"},null,512),u(a,{onBasemapChanged:Ae}),s("div",et,[u(i,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=r=>V.value=r),options:H,onFilter:_e},null,8,["modelValue"])]),s("div",tt,[u(i,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=r=>V.value=r),options:H,onFilter:_e},null,8,["modelValue"])])]),_:1}),u(U,{cols:"12",md:"6",class:"info-section pa-5"},{default:c(()=>[l.value?(v(),b("div",ot,[s("div",it,[s("div",null,[s("span",rt,m(l.value.county)+" | "+m(l.value.township),1)])]),s("h1",ut,m(l.value.name),1),s("div",dt,[u(Fe,{class:"bg-white",color:"orange",size:t.$vuetify.display.mdAndUp?"default":"small"},{default:c(()=>[D(m(l.value.status),1)]),_:1},8,["size"])]),u(Be,{class:"mt-4"},{default:c(()=>[u(We,{class:"info-title"},{default:c(()=>[e[7]||(e[7]=D(" 基本資訊 ")),u(K,{class:"mt-2"})]),_:1}),u(Ue,null,{default:c(()=>[s("div",ct,[e[15]||(e[15]=s("div",{class:"info-label"}," 土地開發名稱： ",-1)),s("div",vt,m(l.value.name),1),e[16]||(e[16]=s("div",{class:"info-label"}," 鄉鎮市區： ",-1)),s("div",ft,m(l.value.township),1),e[17]||(e[17]=s("div",{class:"info-label"}," 開發方式： ",-1)),s("div",mt,m(l.value.method),1),e[18]||(e[18]=s("div",{class:"info-label"}," 辦理情形： ",-1)),s("div",pt,m(l.value.status),1),e[19]||(e[19]=s("div",{class:"info-label"}," 開發總面積： ",-1)),s("div",_t,m(l.value.area)+" 公頃 ",1),e[20]||(e[20]=s("div",{class:"info-label"}," 開發期程： ",-1)),s("div",gt,m(l.value.timeline),1),e[21]||(e[21]=s("div",{class:"info-label"}," 主辦單位： ",-1)),e[22]||(e[22]=s("div",{class:"info-value"}," 宜蘭縣政府 ",-1)),l.value.constructionProgress!==void 0?(v(),b(k,{key:0},[e[8]||(e[8]=s("div",{class:"info-label"}," 施工進度： ",-1)),s("div",ht,[s("div",yt,[u(ye,{"model-value":l.value.constructionProgress,color:"primary",height:"20",rounded:"",class:"mb-1"},{default:c(({value:r})=>[s("strong",wt,m(Math.ceil(r))+"%",1)]),_:1},8,["model-value"])])])],64)):S("",!0),l.value.estimatedProgress!==void 0?(v(),b(k,{key:1},[e[9]||(e[9]=s("div",{class:"info-label"}," 預估進度： ",-1)),s("div",bt,[s("div",xt,[u(ye,{"model-value":l.value.estimatedProgress,color:"secondary",height:"20",rounded:"",class:"mb-1"},{default:c(({value:r})=>[s("strong",Vt,m(Math.ceil(r))+"%",1)]),_:1},8,["model-value"])])])],64)):S("",!0),l.value.siteCondition&&l.value.siteCondition.length>0?(v(),b(k,{key:2},[e[10]||(e[10]=s("div",{class:"info-label full-width-label"}," 基地現況 ",-1)),s("div",Pt,[u(K,{class:"mb-3"}),s("div",Et,[u(M,{class:"mb-2"},{default:c(()=>[(v(!0),b(k,null,X(l.value.siteCondition.slice(0,2),(r,p)=>(v(),O(U,{key:p,cols:"6",sm:"6",md:"6",class:"pa-1"},{default:c(()=>[u(we,{src:r,alt:`基地現況 ${p+1}`,height:"120",cover:"",class:"rounded cursor-pointer",onClick:e[3]||(e[3]=I=>B(l.value.siteCondition))},{placeholder:c(()=>[u(M,{class:"fill-height ma-0",align:"center",justify:"center"},{default:c(()=>[u(xe,{size:"20",indeterminate:"",color:"grey-lighten-5"})]),_:1})]),_:2},1032,["src","alt"])]),_:2},1024))),128))]),_:1})])])],64)):S("",!0),l.value.aerialPhoto&&l.value.aerialPhoto.length>0?(v(),b(k,{key:3},[e[11]||(e[11]=s("div",{class:"info-label full-width-label"}," 空拍圖 ",-1)),s("div",kt,[u(K,{class:"mb-3"}),s("div",St,[u(M,{class:"mb-2"},{default:c(()=>[(v(!0),b(k,null,X(l.value.aerialPhoto.slice(0,2),(r,p)=>(v(),O(U,{key:p,cols:"6",sm:"6",md:"6",class:"pa-1"},{default:c(()=>[u(we,{src:r,alt:`空拍圖 ${p+1}`,height:"120",cover:"",class:"rounded cursor-pointer",onClick:e[4]||(e[4]=I=>B(l.value.aerialPhoto))},{placeholder:c(()=>[u(M,{class:"fill-height ma-0",align:"center",justify:"center"},{default:c(()=>[u(xe,{size:"20",indeterminate:"",color:"grey-lighten-5"})]),_:1})]),_:2},1032,["src","alt"])]),_:2},1024))),128))]),_:1})])])],64)):S("",!0),l.value.preliminaryWork&&l.value.preliminaryWork.length>0||l.value.planApproval&&l.value.planApproval.length>0?(v(),b(k,{key:4},[e[14]||(e[14]=s("div",{class:"info-label"}," 相關資料： ",-1)),s("div",Lt,[s("div",At,[l.value.preliminaryWork&&l.value.preliminaryWork.length>0?(v(),O(be,{key:0,color:"primary",size:"small",class:"mr-2 mb-2",onClick:e[5]||(e[5]=r=>B(l.value.preliminaryWork))},{default:c(()=>e[12]||(e[12]=[D(" 先行作業 ")])),_:1})):S("",!0),l.value.planApproval&&l.value.planApproval.length>0?(v(),O(be,{key:1,color:"primary",size:"small",class:"mb-2",onClick:e[6]||(e[6]=r=>B(l.value.planApproval))},{default:c(()=>e[13]||(e[13]=[D(" 計劃核准 ")])),_:1})):S("",!0)])])],64)):S("",!0)])]),_:1})]),_:1})])):(v(),b("div",at,[s("div",lt,[u(ee,{size:"80",color:"white"},{default:c(()=>[D(m(Z.value==="no-results"?"mdi-magnify-close":"mdi-map-marker-outline"),1)]),_:1})]),s("h2",st,m(Se()),1),s("p",nt,m(Le()),1)]))]),_:1})]),_:1})]),_:1})}}},Nt=Q(Ct,[["__scopeId","data-v-7d84b4ff"]]);export{Nt as default};
