import{C as S,M as k}from"./D_uhChHx.js";import"./CBsAYBMq.js";import"./BBoprNr9.js";/*!
  * ol-contextmenu - v5.5.0
  * https://github.com/jonataswalker/ol-contextmenu
  * Built: Wed Aug 07 2024 12:29:18 GMT+0000 (Coordinated Universal Time)
  */var I=Object.defineProperty,T=(n,e,t)=>e in n?I(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,r=(n,e,t)=>T(n,typeof e!="symbol"?e+"":e,t),N={exports:{}};function M(){}M.prototype={on:function(n,e,t){var s=this.e||(this.e={});return(s[n]||(s[n]=[])).push({fn:e,ctx:t}),this},once:function(n,e,t){var s=this;function i(){s.off(n,i),e.apply(t,arguments)}return i._=e,this.on(n,i,t)},emit:function(n){var e=[].slice.call(arguments,1),t=((this.e||(this.e={}))[n]||[]).slice(),s=0,i=t.length;for(s;s<i;s++)t[s].fn.apply(t[s].ctx,e);return this},off:function(n,e){var t=this.e||(this.e={}),s=t[n],i=[];if(s&&e)for(var o=0,l=s.length;o<l;o++)s[o].fn!==e&&s[o].fn._!==e&&i.push(s[o]);return i.length?t[n]=i:delete t[n],this}};N.exports=M;var O=N.exports.TinyEmitter=M,x=(n=>(n.CONTEXTMENU="contextmenu",n.CLICK="click",n.DBLCLICK="dblclick",n))(x||{}),p=(n=>(n.BEFOREOPEN="beforeopen",n.OPEN="open",n.CLOSE="close",n.ADD_MENU_ENTRY="add-menu-entry",n))(p||{});class w extends k{constructor(e){super(e.type,e.map,e.originalEvent)}}const D={width:150,scrollAt:4,eventType:x.CONTEXTMENU,defaultItems:!0,items:[]},E="ol-ctx-menu",a={container:`${E}-container`,separator:`${E}-separator`,submenu:`${E}-submenu`,hidden:`${E}-hidden`,icon:`${E}-icon`,zoomIn:`${E}-zoom-in`,zoomOut:`${E}-zoom-out`,unselectable:"ol-unselectable"},L=[{text:"Zoom In",classname:`${a.zoomIn} ${a.icon}`,callback:(n,e)=>{const t=e.getView();t.animate({zoom:Number(t.getZoom())+1,duration:700,center:n.coordinate})}},{text:"Zoom Out",classname:`${a.zoomOut} ${a.icon}`,callback:(n,e)=>{const t=e.getView();t.animate({zoom:Number(t.getZoom())-1,duration:700,center:n.coordinate})}}];function y(n){const e=document.createDocumentFragment(),t=document.createElement("div");for(t.innerHTML=n;t.firstChild;)e.append(t.firstChild);return e}function _(n){var d,m;const e=document.importNode(n),t=n.offsetWidth;e.style.cssText=`position: fixed; top: 0; left: 0; overflow: auto; visibility: hidden; pointer-events: none; height: unset; max-height: unset; width: ${t}px`;const s=y("<span>Foo</span>"),i=y("<span>Foo</span>"),o=document.createElement("li"),l=document.createElement("li");o.append(s),l.append(i),e.append(o),e.append(l),(d=n.parentNode)==null||d.append(e);const h=e.offsetHeight/2;return(m=n.parentNode)==null||m.removeChild(e),h}function C({parentNode:n,item:e,isSubmenu:t=!1,isInsideSubmenu:s=!1,emitter:i}){const o=`_${Math.random().toString(36).slice(2,11)}`;if(typeof e!="string"&&"text"in e){const f=`<span>${e.text}</span>`,b=y(f),u=document.createElement("li");e.classname=e.classname||"",e.icon&&(e.classname===""?e.classname=a.icon:e.classname.includes(a.icon)===!1&&(e.classname+=` ${a.icon}`),u.setAttribute("style",`background-image:url(${e.icon})`)),u.id=o,u.className=e.classname,u.append(b),n.append(u);const c={id:o,isSubmenu:t,isInsideSubmenu:s,isSeparator:!1,callback:"callback"in e?e.callback:null,data:"data"in e?e.data:null};return i.emit(p.ADD_MENU_ENTRY,c,u),u}const l=`<li id="${o}" class="${a.separator}"><hr></li>`,h=y(l);n.append(h);const d=n.lastChild,m={id:o,isSubmenu:!1,isInsideSubmenu:!1,isSeparator:!0,callback:null,data:null};return i.emit(p.ADD_MENU_ENTRY,m,d),d}function g({container:n,items:e,menuWidth:t,isInsideSubmenu:s,emitter:i}){e.forEach(o=>{if(typeof o!="string"&&"items"in o&&Array.isArray(o.items)){const l=C({parentNode:n,item:o,isSubmenu:!0,emitter:i});l.classList.add(a.submenu);const h=document.createElement("ul");h.classList.add(a.container),h.style.width=`${t}px`,l.append(h),g({emitter:i,menuWidth:t,container:h,items:o.items,isInsideSubmenu:!0})}else C({parentNode:n,item:o,isSubmenu:!1,isInsideSubmenu:s,emitter:i})})}function v(n,e){if(!n)throw new Error(e)}class R extends S{constructor(e={}){v(typeof e=="object","@param `opts` should be object type!");const t=document.createElement("div");super({element:t}),r(this,"map"),r(this,"emitter",new O),r(this,"container"),r(this,"coordinate",[]),r(this,"pixel",[]),r(this,"contextMenuEventListener"),r(this,"entryCallbackEventListener"),r(this,"mapMoveListener"),r(this,"lineHeight",0),r(this,"disabled"),r(this,"opened"),r(this,"items",[]),r(this,"menuEntries",new Map),r(this,"options"),this.options={...D,...e};const s=document.createElement("ul");t.append(s),t.style.width=`${this.options.width}px`,t.classList.add(a.container,a.unselectable,a.hidden),this.container=t,this.contextMenuEventListener=i=>{this.handleContextMenu(i)},this.entryCallbackEventListener=i=>{this.handleEntryCallback(i)},this.mapMoveListener=()=>{this.handleMapMove()},this.disabled=!1,this.opened=!1,window.addEventListener("beforeunload",()=>{this.removeListeners()},{once:!0})}clear(){for(const e of this.menuEntries.keys())this.removeMenuEntry(e);this.container.replaceChildren(),this.container.append(document.createElement("ul"))}enable(){this.disabled=!1}disable(){this.disabled=!0}getDefaultItems(){return L}countItems(){return this.menuEntries.size}extend(e){v(Array.isArray(e),"@param `items` should be an Array."),g({items:e,emitter:this.emitter,menuWidth:this.options.width,container:this.container.firstElementChild})}closeMenu(){this.opened=!1,this.container.classList.add(a.hidden),this.dispatchEvent(p.CLOSE)}isOpen(){return this.opened}updatePosition(e){v(Array.isArray(e),"@param `pixel` should be an Array."),this.isOpen()&&(this.pixel=e,this.positionContainer())}pop(){const e=Array.from(this.menuEntries.keys()).pop();e&&this.removeMenuEntry(e)}shift(){const e=Array.from(this.menuEntries.keys()).shift();e&&this.removeMenuEntry(e)}push(e){e&&this.extend([e])}setMap(e){if(super.setMap(e),e){this.map=e,e.getViewport().addEventListener(this.options.eventType,this.contextMenuEventListener,!1),e.on("movestart",()=>{this.handleMapMove()}),this.emitter.on(p.ADD_MENU_ENTRY,(s,i)=>{this.handleAddMenuEntry(s,i)},this),this.items=this.options.defaultItems?this.options.items.concat(L):this.options.items,g({items:this.items,emitter:this.emitter,menuWidth:this.options.width,container:this.container.firstElementChild});const t=this.getMenuEntriesLength();this.lineHeight=t>0?this.container.offsetHeight/t:_(this.container)}else this.removeListeners(),this.clear()}removeListeners(){this.map.getViewport().removeEventListener(this.options.eventType,this.contextMenuEventListener,!1),this.emitter.off(p.ADD_MENU_ENTRY)}removeMenuEntry(e){let t=document.getElementById(e);t==null||t.remove(),t=null,this.menuEntries.delete(e)}handleContextMenu(e){var t;this.coordinate=this.map.getEventCoordinate(e),this.pixel=this.map.getEventPixel(e),this.dispatchEvent(new w({map:this.map,originalEvent:e,type:p.BEFOREOPEN})),!this.disabled&&(this.options.eventType===x.CONTEXTMENU&&(e.stopPropagation(),e.preventDefault()),setTimeout(()=>{this.openMenu(e)}),(t=e.target)==null||t.addEventListener("pointerdown",s=>{this.opened&&(s.stopPropagation(),this.closeMenu())},{once:!0}))}openMenu(e){this.opened=!0,this.positionContainer(),this.container.classList.remove(a.hidden),this.dispatchEvent(new w({map:this.map,originalEvent:e,type:p.OPEN}))}getMenuEntriesLength(){return Array.from(this.menuEntries).filter(([,e])=>e.isSeparator===!1&&e.isSubmenu===!1&&e.isInsideSubmenu===!1).length}positionContainer(){const e=this.map.getSize()||[0,0],t={w:e[0]-this.pixel[0],h:e[1]-this.pixel[1]},s=this.getMenuEntriesLength(),i={w:this.container.offsetWidth,h:Math.round(this.lineHeight*s)},o=t.w>=i.w?this.pixel[0]+5:this.pixel[0]-i.w;this.container.style.left=`${o}px`,this.container.style.top=t.h>=i.h?`${this.pixel[1]-10}px`:`${this.pixel[1]-i.h}px`,this.container.style.right="auto",this.container.style.bottom="auto",t.w-=i.w;const l=m=>Array.from(m.children).filter(f=>f.tagName==="LI"&&f.classList.contains(a.submenu));let h=0;const d=(m,f)=>{h+=1,l(m).forEach(b=>{const u=f>=i.w?i.w-8:(i.w+8)*-1,c=b.querySelector(`ul.${a.container}`),$=Math.round(this.lineHeight*Array.from(c.children).filter(A=>A.tagName==="LI").length);c.style.left=`${u}px`,c.style.right="auto",c.style.top=t.h>=$+i.h?"0":`-${c.offsetHeight-25}px`,c.style.bottom="auto",c.style.zIndex=String(h),l(c).length>0&&d(c,f-i.w)})};d(this.container.firstElementChild,t.w)}handleMapMove(){this.closeMenu()}handleEntryCallback(e){var o;e.preventDefault(),e.stopPropagation();const t=e.currentTarget,s=this.menuEntries.get(t.id);if(!s)return;const i={data:s.data,coordinate:this.coordinate};this.closeMenu(),(o=s.callback)==null||o.call(s,i,this.map)}handleAddMenuEntry(e,t){this.menuEntries.set(e.id,e),this.positionContainer(),"callback"in e&&typeof e.callback=="function"&&t.addEventListener("click",this.entryCallbackEventListener,!1)}}export{R as default};
