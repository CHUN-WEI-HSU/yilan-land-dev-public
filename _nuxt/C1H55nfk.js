import{V as l}from"./Db2rOhY5.js";import{a as d}from"./NcfOxGOJ.js";import{b as o,u,l as h,E as c,B as g}from"./CBsAYBMq.js";import{o as y}from"./1jRA9jIJ.js";import{B as f}from"./BBoprNr9.js";import{c as _}from"./Ba_gg6Bw.js";const r={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class R extends f{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[r.OPACITY]=e.opacity!==void 0?e.opacity:1,d(typeof t[r.OPACITY]=="number","Layer opacity must be a number"),t[r.VISIBLE]=e.visible!==void 0?e.visible:!0,t[r.Z_INDEX]=e.zIndex,t[r.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[r.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[r.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[r.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},s=this.getZIndex();return t.opacity=_(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=s===void 0&&!t.managed?1/0:s,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return o()}getLayerStatesArray(e){return o()}getExtent(){return this.get(r.EXTENT)}getMaxResolution(){return this.get(r.MAX_RESOLUTION)}getMinResolution(){return this.get(r.MIN_RESOLUTION)}getMinZoom(){return this.get(r.MIN_ZOOM)}getMaxZoom(){return this.get(r.MAX_ZOOM)}getOpacity(){return this.get(r.OPACITY)}getSourceState(){return o()}getVisible(){return this.get(r.VISIBLE)}getZIndex(){return this.get(r.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(r.EXTENT,e)}setMaxResolution(e){this.set(r.MAX_RESOLUTION,e)}setMinResolution(e){this.set(r.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(r.MAX_ZOOM,e)}setMinZoom(e){this.set(r.MIN_ZOOM,e)}setOpacity(e){d(typeof e=="number","Layer opacity must be a number"),this.set(r.OPACITY,e)}setVisible(e){this.set(r.VISIBLE,e)}setZIndex(e){this.set(r.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const p={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class b extends R{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(r.SOURCE,this.handleSourcePropertyChange_);const s=e.source?e.source:null;this.setSource(s)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(r.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(u(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=h(e,c.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0)),this.clearRenderer()),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const s=this.getMapInternal();!e&&s&&(e=s.getView()),e instanceof l?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&s&&(t.layerStatesArray=s.getLayerGroup().getLayerStatesArray());let n;if(t.layerStatesArray){if(n=t.layerStatesArray.find(m=>m.layer===this),!n)return!1}else n=this.getLayerState();const a=this.getExtent();return S(n,t.viewState)&&(!a||y(a,t.extent))}getAttributions(e){var a;if(!this.isVisible(e))return[];const t=(a=this.getSource())==null?void 0:a.getAttributions();if(!t)return[];const s=e instanceof l?e.getViewStateAndExtent():e;let n=t(s);return Array.isArray(n)||(n=[n]),n}render(e,t){const s=this.getRenderer();return s.prepareFrame(e)?(this.rendered=!0,s.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(r.MAP,e)}getMapInternal(){return this.get(r.MAP)}setMap(e){this.mapPrecomposeKey_&&(u(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(u(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=h(e,p.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=h(this,c.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const t=e.frameState.layerStatesArray,s=this.getLayerState(!1);d(!t.some(n=>n.layer===s.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(s)}setSource(e){this.set(r.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function S(i,e){if(!i.visible)return!1;const t=e.resolution;if(t<i.minResolution||t>=i.maxResolution)return!1;const s=e.zoom;return s>i.minZoom&&s<=i.maxZoom}class N extends g{constructor(e,t,s,n){super(e),this.inversePixelTransform=t,this.frameState=s,this.context=n}}export{R as B,b as L,N as R,p as a,S as i};
