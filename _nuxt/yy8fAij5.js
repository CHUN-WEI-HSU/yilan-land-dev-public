import{p as te,m as ae,r as W,f as le,B as me,b as l,A as R,C as fe,a as p,F as S,z as pe,s as ce,x as ve,y as be,D as ge,I as Ve,E as re,v as ye,n as ke,G as Ce,H as we,l as Pe,u as xe,g as ne,h as Se,c as z,w as t,d as f,j as y,t as E,k as Ae,J as K,K as Q,i as Ue,o as k,e as X,_ as De}from"./CtiptTIU.js";import{u as ze}from"./CZo5CsfA.js";import{t as Fe,d as Ie,p as Be}from"./CUcIaLN8.js";import{l as he}from"./BbohOuBu.js";import{V as _,a as q,b as M,c as N,d as m}from"./B7bkZI78.js";import{V as L}from"./BBl5NXvx.js";import{V as Te}from"./Bi8knA0y.js";import{V as Ne}from"./C8T3a-wt.js";import{V as B}from"./NwnemnFG.js";import{V as ee,a as Y}from"./C-Z_m-nC.js";import{V as $e}from"./BqdUcUm8.js";import{m as Re,V as se,a as je,b as We,c as $,d as Le}from"./Bqg6UD3P.js";import{d as oe,m as Ee,b as _e,c as qe,e as Me,u as Oe,V as F}from"./v5m7S0p5.js";import{V as G,n as j,g as Ge,h as He,i as Je,j as Ke,o as Qe,p as Xe,b as Ye,d as Ze,e as el,f as ll,k as tl,a as al}from"./DIhnNZwz.js";import"./CgiVEhsX.js";import"./BevvzU36.js";const ol=te({clearable:Boolean,file:{type:Object,default:null},fileIcon:{type:String,default:"mdi-file-document"},showSize:Boolean,...Re({border:!0,rounded:!0,lines:"two"})},"VFileUploadItem"),O=ae()({name:"VFileUploadItem",props:ol(),emits:{"click:remove":()=>!0,click:o=>!0},setup(o,P){let{emit:A,slots:s}=P;const V=W(),I=le(()=>typeof o.showSize!="boolean"?o.showSize:void 0);function g(){A("click:remove")}me(()=>{var c;V.value=(c=o.file)!=null&&c.type.startsWith("image")?URL.createObjectURL(o.file):void 0}),oe(()=>{var C,v,b;const c=se.filterProps(o);return l(se,R(c,{title:o.title??((C=o.file)==null?void 0:C.name),subtitle:o.showSize?fe((v=o.file)==null?void 0:v.size,I.value):(b=o.file)==null?void 0:b.type,class:"v-file-upload-item"}),{...s,prepend:w=>p(S,null,[s.prepend?l(G,{defaults:{VAvatar:{image:V.value,icon:V.value?void 0:o.fileIcon,rounded:!0}}},{default:()=>{var n;return[((n=s.prepend)==null?void 0:n.call(s,w))??l(j,null,null)]}}):l(j,{icon:o.fileIcon,image:V.value,rounded:!0},null)]),append:w=>{var n;return p(S,null,[o.clearable&&p(S,null,[s.clear?l(G,{defaults:{VBtn:{icon:"$clear",density:"comfortable",variant:"text"}}},{default:()=>{var d;return[((d=s.clear)==null?void 0:d.call(s,{...w,props:{onClick:g}}))??l(L,null,null)]}}):l(L,{icon:"$clear",density:"comfortable",variant:"text",onClick:g},null)]),(n=s.append)==null?void 0:n.call(s,w)])}})})}}),de=te({color:String,...Qe(),...qe(),..._e(),...Ke(),...Je(),...He(),...Ge(),...Ee(),...pe()},"VSheet"),ue=ae()({name:"VSheet",props:de(),setup(o,P){let{slots:A}=P;const{themeClasses:s}=ce(o),{backgroundColorClasses:V,backgroundColorStyles:I}=Me(()=>o.color),{borderClasses:g}=Xe(o),{dimensionStyles:c}=Oe(o),{elevationClasses:C}=Ye(o),{locationStyles:v}=Ze(o),{positionClasses:b}=el(o),{roundedClasses:w}=ll(o);return oe(()=>l(o.tag,{class:ve(["v-sheet",s.value,V.value,g.value,C.value,b.value,w.value,o.class]),style:be([I.value,c.value,v.value,o.style])},A)),{}}}),il=te({browseText:{type:String,default:"$vuetify.fileUpload.browse"},dividerText:{type:String,default:"$vuetify.fileUpload.divider"},title:{type:String,default:"$vuetify.fileUpload.title"},subtitle:String,icon:{type:Ve,default:"$upload"},modelValue:{type:[Array,Object],default:null,validator:o=>re(o).every(P=>P!=null&&typeof P=="object")},clearable:Boolean,disabled:Boolean,hideBrowse:Boolean,multiple:Boolean,scrim:{type:[Boolean,String],default:!0},showSize:Boolean,name:String,...je(),...tl(),...ge(We({length:150}),["length","thickness","opacity"]),...de()},"VFileUpload"),Z=ae()({name:"VFileUpload",inheritAttrs:!1,props:il(),emits:{"update:modelValue":o=>!0},setup(o,P){let{attrs:A,slots:s}=P;const{t:V}=ye(),{densityClasses:I}=al(o),g=ke(o,"modelValue",o.modelValue,u=>re(u),u=>o.multiple||Array.isArray(o.modelValue)?u:u[0]),c=Ce(!1),C=W(null),v=W(null);function b(u){u.preventDefault(),u.stopImmediatePropagation(),c.value=!0}function w(u){u.preventDefault(),c.value=!1}function n(u){var i,e;if(u.preventDefault(),u.stopImmediatePropagation(),c.value=!1,!((e=(i=u.dataTransfer)==null?void 0:i.files)!=null&&e.length)||!v.value)return;const U=new DataTransfer;for(const a of u.dataTransfer.files)U.items.add(a);v.value.files=U.files,v.value.dispatchEvent(new Event("change",{bubbles:!0}))}function d(){var u;(u=v.value)==null||u.click()}function h(u){const U=g.value.filter((i,e)=>e!==u);g.value=U,!(U.length>0||!v.value)&&(v.value.value="")}oe(()=>{const u=!!(s.title||o.title),U=!!(s.icon||o.icon),i=!!(!o.hideBrowse&&(s.browse||o.density==="default")),e=ue.filterProps(o),a=$.filterProps(o),[r,T]=we(A),H=p("input",R({ref:v,type:"file",disabled:o.disabled,multiple:o.multiple,name:o.name,onChange:x=>{if(!x.target)return;const D=x.target;g.value=[...D.files??[]]}},T),null);return p(S,null,[l(ue,R({ref:C},e,{class:["v-file-upload",{"v-file-upload--clickable":!i,"v-file-upload--disabled":o.disabled,"v-file-upload--dragging":c.value},I.value,o.class],style:[o.style],onDragleave:w,onDragover:b,onDrop:n,onClick:i?void 0:d},r),{default:()=>{var x,D,J;return[U&&p("div",{key:"icon",class:"v-file-upload-icon"},[s.icon?l(G,{key:"icon-defaults",defaults:{VIcon:{icon:o.icon}}},{default:()=>[s.icon()]}):l(F,{key:"icon-icon",icon:o.icon},null)]),u&&p("div",{key:"title",class:"v-file-upload-title"},[((x=s.title)==null?void 0:x.call(s))??V(o.title)]),o.density==="default"&&p(S,null,[p("div",{key:"upload-divider",class:"v-file-upload-divider"},[((D=s.divider)==null?void 0:D.call(s))??l($,a,{default:()=>[V(o.dividerText)]})]),i&&p(S,null,[s.browse?l(G,{defaults:{VBtn:{readonly:o.disabled,size:"large",text:V(o.browseText),variant:"tonal"}}},{default:()=>[s.browse({props:{onClick:d}})]}):l(L,{readonly:o.disabled,size:"large",text:V(o.browseText),variant:"tonal",onClick:d},null)]),o.subtitle&&p("div",{class:"v-file-upload-subtitle"},[o.subtitle])]),l(Le,{"model-value":c.value,contained:!0,scrim:o.scrim},null),((J=s.input)==null?void 0:J.call(s,{inputNode:H}))??H]}}),g.value.length>0&&p("div",{class:"v-file-upload-items"},[g.value.map((x,D)=>{const J={file:x,props:{"onClick:remove":()=>h(D)}};return l(G,{key:D,defaults:{VFileUploadItem:{file:x,clearable:o.clearable,disabled:o.disabled,showSize:o.showSize}}},{default:()=>{var ie;return[((ie=s.item)==null?void 0:ie.call(s,J))??l(O,{key:D,"onClick:remove":()=>h(D)},s)]}})})])])})}}),nl={key:0,class:"mt-3"},sl={key:0,class:"mt-3"},ul={key:0,class:"mt-2"},rl={key:0,class:"mt-2"},dl=Pe({__name:"[action]",setup(o){const P=xe(),A=Ue(),{showSuccess:s}=ze(),V=he,I=le(()=>P.params.id||null),g=le(()=>!!I.value),c=W(!1),C=W(!1),v=W(null),b={name:[i=>!!i||"請輸入土地開發名稱",i=>i&&i.length<=100||"名稱不可超過100個字元"],required:[i=>!!i||"此欄位為必填"],number:[i=>!i||!isNaN(Number(i))||"請輸入有效的數字"],longitude:[i=>!i||!isNaN(Number(i))&&Number(i)>=120&&Number(i)<=122||"經度範圍應在120-122之間"],latitude:[i=>!i||!isNaN(Number(i))&&Number(i)>=23&&Number(i)<=26||"緯度範圍應在23-26之間"]},w=[i=>!i||!isNaN(Number(i))&&Number(i)>=0&&Number(i)<=100||"請輸入0-100之間的數字"],n=ne({name:"",township:"",developmentMethod:"",processingStatus:"",timeline:"",totalArea:null,publicFacilityArea:null,planningScope:"",longitude:null,latitude:null,constructionProgress:null,estimatedProgress:null,siteCondition:[],aerialPhoto:[],preliminaryWork:[],planApproval:[]}),d=ne({siteCondition:[],aerialPhoto:[],preliminaryWork:[],planApproval:[]}),h=(i,e)=>{if(!e){d[i]=[];return}const a=Array.isArray(e)?e:[e],r=["siteCondition","aerialPhoto"].includes(i)?2:10;a.length>r?d[i]=a.slice(0,r):d[i]=a},u=(i,e)=>{Array.isArray(n[i])&&n[i].splice(e,1)},U=async()=>{var i;if((i=v.value)!=null&&i.validate()){C.value=!0;try{["siteCondition","aerialPhoto","preliminaryWork","planApproval"].forEach(a=>{const r=d[a];if(r&&r.length>0){const T=r.map((H,x)=>`/uploads/${a}-${Date.now()}-${x}.${H.name.split(".").pop()}`);n[a].push(...T)}}),await new Promise(a=>setTimeout(a,500)),s(g.value?"成功更新土地開發區資料":"成功新增土地開發區資料"),A.push("/admin/land-dev")}catch(e){console.error("儲存失敗",e)}finally{C.value=!1}}};return Se(()=>{if(g.value){C.value=!0;try{const i=V.find(e=>e.id===Number(I.value));i&&Object.assign(n,i)}catch(i){console.error("獲取資料失敗",i)}finally{C.value=!1}}}),(i,e)=>(k(),z("div",null,[l(_,null,{default:t(()=>[l(q,{class:"d-flex align-center"},{default:t(()=>[l(L,{icon:"mdi-arrow-left",variant:"text",class:"mr-2",onClick:e[0]||(e[0]=a=>y(A).back())}),f(" "+E(g.value?"編輯土地開發區":"新增土地開發區"),1)]),_:1}),l(M,null,{default:t(()=>[l(Te,{ref_key:"form",ref:v,modelValue:c.value,"onUpdate:modelValue":e[22]||(e[22]=a=>c.value=a),onSubmit:Ae(U,["prevent"])},{default:t(()=>[l(Ne,null,{default:t(()=>[l(N,null,{default:t(()=>[l(m,{cols:"12",md:"6"},{default:t(()=>[l(B,{modelValue:n.name,"onUpdate:modelValue":e[1]||(e[1]=a=>n.name=a),rules:b.name,label:"土地開發名稱",required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),l(m,{cols:"12",md:"6"},{default:t(()=>[l(ee,{modelValue:n.township,"onUpdate:modelValue":e[2]||(e[2]=a=>n.township=a),items:y(Fe),"item-title":"text","item-value":"value",label:"鄉鎮市區",required:"",rules:b.required,variant:"outlined"},null,8,["modelValue","items","rules"])]),_:1}),l(m,{cols:"12",md:"6"},{default:t(()=>[l(ee,{modelValue:n.developmentMethod,"onUpdate:modelValue":e[3]||(e[3]=a=>n.developmentMethod=a),items:y(Ie),"item-title":"text","item-value":"value",label:"開發方式",required:"",rules:b.required,variant:"outlined"},null,8,["modelValue","items","rules"])]),_:1}),l(m,{cols:"12",md:"6"},{default:t(()=>[l(ee,{modelValue:n.processingStatus,"onUpdate:modelValue":e[4]||(e[4]=a=>n.processingStatus=a),items:y(Be),"item-title":"text","item-value":"value",label:"辦理情形",required:"",rules:b.required,variant:"outlined"},null,8,["modelValue","items","rules"])]),_:1}),l(m,{cols:"12",md:"6"},{default:t(()=>[l(B,{modelValue:n.timeline,"onUpdate:modelValue":e[5]||(e[5]=a=>n.timeline=a),label:"開發期程",variant:"outlined",placeholder:"例：110年1月至111年12月"},null,8,["modelValue"])]),_:1}),l(m,{cols:"12",md:"6"},{default:t(()=>[l(B,{modelValue:n.totalArea,"onUpdate:modelValue":e[6]||(e[6]=a=>n.totalArea=a),label:"開發總面積 (公頃)",rules:b.number,variant:"outlined",type:"number",step:"0.01"},null,8,["modelValue","rules"])]),_:1}),l(m,{cols:"12",md:"6"},{default:t(()=>[l(B,{modelValue:n.publicFacilityArea,"onUpdate:modelValue":e[7]||(e[7]=a=>n.publicFacilityArea=a),label:"公共設施面積 (公頃)",rules:b.number,variant:"outlined",type:"number",step:"0.01"},null,8,["modelValue","rules"])]),_:1}),l(m,{cols:"12"},{default:t(()=>[l($e,{modelValue:n.planningScope,"onUpdate:modelValue":e[8]||(e[8]=a=>n.planningScope=a),label:"計畫範圍",variant:"outlined",rows:"3",placeholder:"請詳細描述計畫範圍..."},null,8,["modelValue"])]),_:1}),l(m,{cols:"12",md:"6"},{default:t(()=>[l(B,{modelValue:n.longitude,"onUpdate:modelValue":e[9]||(e[9]=a=>n.longitude=a),label:"經度",type:"number",step:"0.000001",rules:b.longitude,variant:"outlined",placeholder:"例：121.753000"},null,8,["modelValue","rules"])]),_:1}),l(m,{cols:"12",md:"6"},{default:t(()=>[l(B,{modelValue:n.latitude,"onUpdate:modelValue":e[10]||(e[10]=a=>n.latitude=a),label:"緯度",type:"number",step:"0.000001",rules:b.latitude,variant:"outlined",placeholder:"例：24.754700"},null,8,["modelValue","rules"])]),_:1})]),_:1}),l($,{class:"my-4"}),l(N,null,{default:t(()=>[l(m,{cols:"12"},{default:t(()=>e[23]||(e[23]=[p("h3",{class:"text-h6 mb-3"}," 進度管理 ",-1)])),_:1}),l(m,{cols:"12",md:"6"},{default:t(()=>[l(B,{modelValue:n.constructionProgress,"onUpdate:modelValue":e[11]||(e[11]=a=>n.constructionProgress=a),label:"施工進度 (%)",type:"number",min:"0",max:"100",variant:"outlined",rules:w,suffix:"%"},null,8,["modelValue"])]),_:1}),l(m,{cols:"12",md:"6"},{default:t(()=>[l(B,{modelValue:n.estimatedProgress,"onUpdate:modelValue":e[12]||(e[12]=a=>n.estimatedProgress=a),label:"預估進度 (%)",type:"number",min:"0",max:"100",variant:"outlined",rules:w,suffix:"%"},null,8,["modelValue"])]),_:1})]),_:1}),l($,{class:"my-4"}),l(N,null,{default:t(()=>[l(m,{cols:"12"},{default:t(()=>[e[34]||(e[34]=p("h3",{class:"text-h6 mb-3"}," 圖片管理 ",-1)),l(N,null,{default:t(()=>[l(m,{cols:"12",md:"6"},{default:t(()=>[l(_,{variant:"outlined",class:"file-upload-card"},{default:t(()=>[l(q,{class:"text-subtitle-1 d-flex align-center"},{default:t(()=>[l(F,{class:"mr-2"},{default:t(()=>e[24]||(e[24]=[f(" mdi-image-multiple ")])),_:1}),e[25]||(e[25]=f(" 基地現況 (最多2張) "))]),_:1}),l(M,null,{default:t(()=>[l(y(Z),{modelValue:d.siteCondition,"onUpdate:modelValue":[e[13]||(e[13]=a=>d.siteCondition=a),e[14]||(e[14]=a=>h("siteCondition",a))],accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",multiple:"",disabled:d.siteCondition&&d.siteCondition.length>=2,"show-size":"",clearable:""},{item:t(({props:a})=>[l(y(O),R(a,{lines:"one"}),{prepend:t(()=>[l(j,{size:"32",rounded:"",color:"success"},{default:t(()=>[l(F,{color:"white"},{default:t(()=>e[26]||(e[26]=[f(" mdi-image ")])),_:1})]),_:1})]),_:2},1040)]),_:1},8,["modelValue","disabled"]),n.siteCondition&&n.siteCondition.length>0?(k(),z("div",nl,[l($,{class:"mb-2"}),e[28]||(e[28]=p("div",{class:"text-caption text-grey-darken-1 mb-2"}," 已上傳到伺服器的檔案： ",-1)),(k(!0),z(S,null,Q(n.siteCondition,(a,r)=>(k(),X(Y,{key:r,closable:"",color:"primary",variant:"outlined",size:"small",class:"mr-2 mb-2","onClick:close":T=>u("siteCondition",r)},{default:t(()=>[l(F,{start:""},{default:t(()=>e[27]||(e[27]=[f(" mdi-check-circle ")])),_:1}),f(" 圖片 "+E(r+1),1)]),_:2},1032,["onClick:close"]))),128))])):K("",!0)]),_:1})]),_:1})]),_:1}),l(m,{cols:"12",md:"6"},{default:t(()=>[l(_,{variant:"outlined",class:"file-upload-card"},{default:t(()=>[l(q,{class:"text-subtitle-1 d-flex align-center"},{default:t(()=>[l(F,{class:"mr-2"},{default:t(()=>e[29]||(e[29]=[f(" mdi-airplane ")])),_:1}),e[30]||(e[30]=f(" 空拍圖 (最多2張) "))]),_:1}),l(M,null,{default:t(()=>[l(y(Z),{modelValue:d.aerialPhoto,"onUpdate:modelValue":[e[15]||(e[15]=a=>d.aerialPhoto=a),e[16]||(e[16]=a=>h("aerialPhoto",a))],accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",multiple:"",disabled:d.aerialPhoto&&d.aerialPhoto.length>=2,"show-size":"",clearable:""},{item:t(({props:a})=>[l(y(O),R(a,{lines:"one"}),{prepend:t(()=>[l(j,{size:"32",rounded:"",color:"info"},{default:t(()=>[l(F,{color:"white"},{default:t(()=>e[31]||(e[31]=[f(" mdi-airplane ")])),_:1})]),_:1})]),_:2},1040)]),_:1},8,["modelValue","disabled"]),n.aerialPhoto&&n.aerialPhoto.length>0?(k(),z("div",sl,[l($,{class:"mb-2"}),e[33]||(e[33]=p("div",{class:"text-caption text-grey-darken-1 mb-2"}," 已上傳到伺服器的檔案： ",-1)),(k(!0),z(S,null,Q(n.aerialPhoto,(a,r)=>(k(),X(Y,{key:r,closable:"",color:"primary",variant:"outlined",size:"small",class:"mr-2 mb-2","onClick:close":T=>u("aerialPhoto",r)},{default:t(()=>[l(F,{start:""},{default:t(()=>e[32]||(e[32]=[f(" mdi-check-circle ")])),_:1}),f(" 圖片 "+E(r+1),1)]),_:2},1032,["onClick:close"]))),128))])):K("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l($,{class:"my-4"}),l(N,null,{default:t(()=>[l(m,{cols:"12"},{default:t(()=>[e[39]||(e[39]=p("h3",{class:"text-h6 mb-3"}," 檔案管理 ",-1)),l(N,null,{default:t(()=>[l(m,{cols:"12",md:"4"},{default:t(()=>[l(_,{variant:"outlined",class:"pa-4"},{default:t(()=>[l(q,{class:"text-subtitle-1"},{default:t(()=>e[35]||(e[35]=[f(" 先行作業 ")])),_:1}),l(M,null,{default:t(()=>[l(y(Z),{modelValue:d.preliminaryWork,"onUpdate:modelValue":[e[17]||(e[17]=a=>d.preliminaryWork=a),e[18]||(e[18]=a=>h("preliminaryWork",a))],accept:".pdf,.doc,.docx,image/*",multiple:"","show-size":"",clearable:""},{item:t(({props:a})=>[l(y(O),R(a,{lines:"one"}),{prepend:t(()=>[l(j,{size:"32",rounded:"",color:"warning"},{default:t(()=>[l(F,{color:"white"},{default:t(()=>e[36]||(e[36]=[f(" mdi-file-document ")])),_:1})]),_:1})]),_:2},1040)]),_:1},8,["modelValue"]),n.preliminaryWork&&n.preliminaryWork.length>0?(k(),z("div",ul,[(k(!0),z(S,null,Q(n.preliminaryWork,(a,r)=>(k(),X(Y,{key:r,closable:"",class:"mr-2 mb-2","onClick:close":T=>u("preliminaryWork",r)},{default:t(()=>[f(" 檔案 "+E(r+1),1)]),_:2},1032,["onClick:close"]))),128))])):K("",!0)]),_:1})]),_:1})]),_:1}),l(m,{cols:"12",md:"4"},{default:t(()=>[l(_,{variant:"outlined",class:"pa-4"},{default:t(()=>[l(q,{class:"text-subtitle-1"},{default:t(()=>e[37]||(e[37]=[f(" 計劃核准 ")])),_:1}),l(M,null,{default:t(()=>[l(y(Z),{modelValue:d.planApproval,"onUpdate:modelValue":[e[19]||(e[19]=a=>d.planApproval=a),e[20]||(e[20]=a=>h("planApproval",a))],accept:".pdf,.doc,.docx,image/*",multiple:"","show-size":"",clearable:""},{item:t(({props:a})=>[l(y(O),R(a,{lines:"one"}),{prepend:t(()=>[l(j,{size:"32",rounded:"",color:"success"},{default:t(()=>[l(F,{color:"white"},{default:t(()=>e[38]||(e[38]=[f(" mdi-file-check ")])),_:1})]),_:1})]),_:2},1040)]),_:1},8,["modelValue"]),n.planApproval&&n.planApproval.length>0?(k(),z("div",rl,[(k(!0),z(S,null,Q(n.planApproval,(a,r)=>(k(),X(Y,{key:r,closable:"",class:"mr-2 mb-2","onClick:close":T=>u("planApproval",r)},{default:t(()=>[f(" 檔案 "+E(r+1),1)]),_:2},1032,["onClick:close"]))),128))])):K("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(N,null,{default:t(()=>[l(m,{cols:"12",class:"d-flex justify-end"},{default:t(()=>[l(L,{variant:"outlined",color:"grey",class:"mr-2",onClick:e[21]||(e[21]=a=>y(A).back())},{default:t(()=>e[40]||(e[40]=[f(" 取消 ")])),_:1}),l(L,{color:"primary",type:"submit",loading:C.value},{default:t(()=>e[41]||(e[41]=[f(" 儲存 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]))}}),Ul=De(dl,[["__scopeId","data-v-aecd872a"]]);export{Ul as default};
