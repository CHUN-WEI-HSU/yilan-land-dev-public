import{I as h,a as z}from"./jmR2vRPQ.js";import{a as l,g as S,E as _}from"./DlQCJ7AR.js";import{I as A,g as y}from"./BDylbOZ5.js";import"./ejpV0U7u.js";import"./Ba_gg6Bw.js";function m(f,e,i,t){return i!==void 0&&t!==void 0?[i/f,t/e]:i!==void 0?i/f:t!==void 0?t/e:1}class I extends A{constructor(e){e=e||{};const i=e.opacity!==void 0?e.opacity:1,t=e.rotation!==void 0?e.rotation:0,r=e.scale!==void 0?e.scale:1,O=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:i,rotation:t,scale:r,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:O,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const n=e.img!==void 0?e.img:null;let s=e.src;l(!(s!==void 0&&n),"`image` and `src` cannot be provided at the same time"),(s===void 0||s.length===0)&&n&&(s=n.src||S(n)),l(s!==void 0&&s.length>0,"A defined and non-empty `src` or `image` must be provided"),l(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let a;if(e.src!==void 0?a=h.IDLE:n!==void 0&&("complete"in n?n.complete?a=n.src?h.LOADED:h.IDLE:a=h.LOADING:a=h.LOADED),this.color_=e.color!==void 0?z(e.color):null,this.iconImage_=y(n,s,this.crossOrigin_,a,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.initialOptions_,e.width!==void 0||e.height!==void 0){let g,o;if(e.size)[g,o]=e.size;else{const c=this.getImage(1);if(c.width&&c.height)g=c.width,o=c.height;else if(c instanceof HTMLImageElement){this.initialOptions_=e;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const u=this.iconImage_.getSize();this.setScale(m(u[0],u[1],e.width,e.height))};this.listenImageChange(d);return}}g!==void 0&&this.setScale(m(g,o,e.width,e.height))}}clone(){let e,i,t;return this.initialOptions_?(i=this.initialOptions_.width,t=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new I({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:i,height:t,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=r[0]),this.anchorYUnits_=="fraction"&&(e[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+r[1])}this.normalizedAnchor_=e}const i=this.getDisplacement(),t=this.getScaleArray();return[e[0]-i[0]/t[0],e[1]+i[1]/t[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const i=this.getSize(),t=this.iconImage_.getSize();if(!i||!t)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=t[0]-i[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=t[1]-i[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==h.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==h.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(_.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(_.CHANGE,e)}ready(){return this.iconImage_.ready()}}export{I as default};
