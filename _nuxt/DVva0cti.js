import{m as M,p as U,n as N,q as A,s as O,v as h,b as a,x as B,y as I,z as G,I as H,a as d,A as J,l as K,r as C,g as Q,c as W,w as o,d as P,j as z,k as X,i as Y,o as Z,_ as ee}from"./CtiptTIU.js";import{u as ae}from"./CZo5CsfA.js";import{useAdminAuthStore as le}from"./xfwkqsNq.js";import{V as te,a as se,b as oe,c as y,d as w}from"./B7bkZI78.js";import{V as b}from"./BBl5NXvx.js";import{V as ne}from"./Bi8knA0y.js";import{V as re}from"./C8T3a-wt.js";import{V as x}from"./NwnemnFG.js";import{c as ie,u as de,a as ue,b as ce,d as me,e as fe,f as ve,m as ye,g as we,h as Ve,i as Pe,j as be,k as ke,l as pe,V as $}from"./DIhnNZwz.js";import{u as ge,a as Ce,m as xe,b as _e,c as Se,V as Te}from"./v5m7S0p5.js";import"./CgiVEhsX.js";const Ae=ie("v-alert-title"),Be=["success","info","warning","error"],Ie=U({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:H,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>Be.includes(e)},...Se(),...ke(),..._e(),...be(),...Pe(),...Ve(),...we(),...xe(),...G(),...ye({variant:"flat"})},"VAlert"),ze=M()({name:"VAlert",props:Ie(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,u){let{emit:k,slots:t}=u;const V=N(e,"modelValue"),i=A(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),{themeClasses:c}=O(e),{colorClasses:m,colorStyles:n,variantClasses:f}=de(()=>({color:e.color??e.type,variant:e.variant})),{densityClasses:p}=ue(e),{dimensionStyles:s}=ge(e),{elevationClasses:l}=ce(e),{locationStyles:r}=me(e),{positionClasses:D}=fe(e),{roundedClasses:j}=ve(e),{textColorClasses:F,textColorStyles:L}=Ce(()=>e.borderColor),{t:R}=h(),_=A(()=>({"aria-label":R(e.closeLabel),onClick(g){V.value=!1,k("click:close",g)}}));return()=>{const g=!!(t.prepend||i.value),q=!!(t.title||e.title),E=!!(t.close||e.closable);return V.value&&a(e.tag,{class:B(["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},c.value,m.value,p.value,l.value,D.value,j.value,f.value,e.class]),style:I([n.value,s.value,r.value,e.style]),role:"alert"},{default:()=>{var S,T;return[pe(!1,"v-alert"),e.border&&d("div",{key:"border",class:B(["v-alert__border",F.value]),style:I(L.value)},null),g&&d("div",{key:"prepend",class:"v-alert__prepend"},[t.prepend?a($,{key:"prepend-defaults",disabled:!i.value,defaults:{VIcon:{density:e.density,icon:i.value,size:e.prominent?44:28}}},t.prepend):a(Te,{key:"prepend-icon",density:e.density,icon:i.value,size:e.prominent?44:28},null)]),d("div",{class:"v-alert__content"},[q&&a(Ae,{key:"title"},{default:()=>{var v;return[((v=t.title)==null?void 0:v.call(t))??e.title]}}),((S=t.text)==null?void 0:S.call(t))??e.text,(T=t.default)==null?void 0:T.call(t)]),t.append&&d("div",{key:"append",class:"v-alert__append"},[t.append()]),E&&d("div",{key:"close",class:"v-alert__close"},[t.close?a($,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var v;return[(v=t.close)==null?void 0:v.call(t,{props:_.value})]}}):a(b,J({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},_.value),null)])]}})}}}),$e=K({__name:"change-password",setup(e){const u=Y(),{showSuccess:k,showError:t}=ae(),V=le(),i=C(!1),c=C(!1),m=C(null),n=Q({currentPassword:"",newPassword:"",confirmPassword:""}),f={currentPassword:[s=>!!s||"請輸入目前密碼"],newPassword:[s=>!!s||"請輸入新密碼",s=>s&&s.length>=6||"密碼至少需要6個字元",s=>s!==n.currentPassword||"新密碼不能與目前密碼相同"],confirmPassword:[s=>!!s||"請確認新密碼",s=>s===n.newPassword||"密碼確認不一致"]},p=async()=>{var s;if(!(!m.value||!m.value.validate())){c.value=!0;try{await V.changePassword(n.currentPassword,n.newPassword,n.confirmPassword),k("密碼變更成功"),Object.assign(n,{currentPassword:"",newPassword:"",confirmPassword:""}),setTimeout(()=>{u.back()},1500)}catch(l){console.error("密碼變更失敗",l);const r=((s=l==null?void 0:l.data)==null?void 0:s.message)||"密碼變更失敗，請稍後再試";t(r)}finally{c.value=!1}}};return(s,l)=>(Z(),W("div",null,[a(te,null,{default:o(()=>[a(se,{class:"d-flex align-center"},{default:o(()=>[a(b,{icon:"mdi-arrow-left",variant:"text",class:"mr-2",onClick:l[0]||(l[0]=r=>z(u).back())}),l[6]||(l[6]=P(" 變更密碼 "))]),_:1}),a(oe,null,{default:o(()=>[a(ne,{ref_key:"form",ref:m,modelValue:i.value,"onUpdate:modelValue":l[5]||(l[5]=r=>i.value=r),onSubmit:X(p,["prevent"])},{default:o(()=>[a(re,null,{default:o(()=>[a(y,null,{default:o(()=>[a(w,{cols:"12",md:"8",lg:"6"},{default:o(()=>[a(x,{modelValue:n.currentPassword,"onUpdate:modelValue":l[1]||(l[1]=r=>n.currentPassword=r),rules:f.currentPassword,label:"目前密碼",type:"password",required:"",variant:"outlined","prepend-inner-icon":"mdi-lock-outline"},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(y,null,{default:o(()=>[a(w,{cols:"12",md:"8",lg:"6"},{default:o(()=>[a(x,{modelValue:n.newPassword,"onUpdate:modelValue":l[2]||(l[2]=r=>n.newPassword=r),rules:f.newPassword,label:"新密碼",type:"password",required:"",variant:"outlined","prepend-inner-icon":"mdi-lock-plus-outline"},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(y,null,{default:o(()=>[a(w,{cols:"12",md:"8",lg:"6"},{default:o(()=>[a(x,{modelValue:n.confirmPassword,"onUpdate:modelValue":l[3]||(l[3]=r=>n.confirmPassword=r),rules:f.confirmPassword,label:"確認新密碼",type:"password",required:"",variant:"outlined","prepend-inner-icon":"mdi-lock-check-outline"},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(y,null,{default:o(()=>[a(w,{cols:"12"},{default:o(()=>[a(ze,{color:"info",variant:"tonal",icon:"mdi-information-outline",class:"mb-4"},{default:o(()=>l[7]||(l[7]=[P(" 密碼要求： "),d("ul",{class:"mt-2"},[d("li",null,"至少6個字元"),d("li",null,"建議包含大小寫字母、數字和特殊符號")],-1)])),_:1})]),_:1})]),_:1}),a(y,null,{default:o(()=>[a(w,{cols:"12",class:"d-flex justify-end"},{default:o(()=>[a(b,{variant:"outlined",color:"grey",class:"mr-2",onClick:l[4]||(l[4]=r=>z(u).back())},{default:o(()=>l[8]||(l[8]=[P(" 取消 ")])),_:1}),a(b,{color:"primary",type:"submit",loading:c.value,disabled:!i.value},{default:o(()=>l[9]||(l[9]=[P(" 變更密碼 ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]))}}),he=ee($e,[["__scopeId","data-v-d47f2f31"]]);export{he as default};
